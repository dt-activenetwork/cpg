# Task 8: CPG å®¹å™¨åŒ–æ¶æ„ - æ„å»ºä¸æŸ¥è¯¢åˆ†ç¦»è®¾è®¡

**ä»»åŠ¡ç±»å‹**: æ¶æ„è®¾è®¡ä¸å®ç°æŒ‡å—
**ä¼˜å…ˆçº§**: P1
**é¢„è®¡å·¥ä½œé‡**: 3-4 å‘¨
**ä¾èµ–**: Task 1, Task 2ï¼ˆç†è§£ CPG æ ¸å¿ƒæ¶æ„ï¼‰
**è¾“å‡º**: æ¶æ„è®¾è®¡æ–‡æ¡£ + å®ç°æŒ‡å— + POC ä»£ç 

---

## 1. é—®é¢˜é™ˆè¿° (Problem Statement)

### 1.1 å½“å‰ CPG ä½¿ç”¨æ¨¡å¼çš„å±€é™æ€§

**ç°çŠ¶**ï¼šCPG å½“å‰æ˜¯å•ä½“è¿è¡Œæ¨¡å¼
```
ç”¨æˆ·ä»£ç :
  TranslationManager.builder()
    .config(...)
    .build()
    .analyze()  // æ„å»ºå›¾

  // ç«‹å³æŸ¥è¯¢
  result.executionPath(...) { ... }
  result.dataFlow(...) { ... }
```

**é—®é¢˜**ï¼š
1. **æ— æ³•å¤ç”¨æ„å»ºç»“æœ**ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦é‡æ–°æ„å»ºå›¾ï¼ˆè€—æ—¶ï¼šå¤§å‹é¡¹ç›®å¯èƒ½ 10+ åˆ†é’Ÿï¼‰
2. **æ— æ³•æ¨ªå‘æ‰©å±•æŸ¥è¯¢**ï¼šä¸€ä¸ªæ„å»ºç»“æœæ— æ³•è¢«å¤šä¸ªæŸ¥è¯¢è¿›ç¨‹å…±äº«
3. **æ— æ³•ç¦»çº¿åˆ†æ**ï¼šæ„å»ºå’ŒæŸ¥è¯¢ç»‘å®šåœ¨åŒä¸€ä¸ªè¿è¡Œç¯å¢ƒ
4. **CI/CD é›†æˆå›°éš¾**ï¼šæ— æ³•åœ¨ CI æ„å»ºå›¾ï¼Œåœ¨ä¸åŒç¯å¢ƒæŸ¥è¯¢

### 1.2 å®é™…ä¸šåŠ¡åœºæ™¯

**åœºæ™¯ 1: CI/CD ä»£ç æ‰«æ**
```
PR æäº¤ â†’ æ„å»ºå®¹å™¨åˆ†æä»£ç  â†’ å¤šä¸ªæŸ¥è¯¢å®¹å™¨å¹¶è¡Œæ‰§è¡Œï¼š
  - å®‰å…¨æ¼æ´æ‰«æ
  - ä»£ç è´¨é‡æ£€æŸ¥
  - è®¸å¯è¯åˆè§„æ£€æŸ¥
  - è‡ªå®šä¹‰ä¸šåŠ¡è§„åˆ™éªŒè¯
```

**åœºæ™¯ 2: ä»£ç å®¡è®¡å¹³å°**
```
ç”¨æˆ·ä¸Šä¼ ä»£ç  â†’ åå°æ„å»ºå›¾ â†’ ç”¨æˆ·é€šè¿‡ Web UI æ‰§è¡ŒåŠ¨æ€æŸ¥è¯¢ï¼š
  - æŸ¥æ‰¾ç‰¹å®š API è°ƒç”¨
  - åˆ†ææ•°æ®æµè·¯å¾„
  - ç”Ÿæˆè°ƒç”¨å›¾
  - å¯¼å‡ºåˆ†ææŠ¥å‘Š
```

**åœºæ™¯ 3: å¤§è§„æ¨¡ä»£ç åˆ†æ**
```
æ„å»ºä¸€æ¬¡ï¼ˆå¤œé—´æ‰¹å¤„ç†ï¼‰â†’ å¤šä¸ªåˆ†æä»»åŠ¡ï¼ˆç™½å¤©ï¼‰ï¼š
  - 100+ ä¸ªä»£ç ä»“åº“
  - æ¯ä¸ªä»“åº“ 10+ ä¸ªåˆ†æç»´åº¦
  - éœ€è¦æ”¯æŒå¢é‡æ›´æ–°
```

**æ ¸å¿ƒéœ€æ±‚**ï¼š**Build Once, Query Many**

---

## 2. æ¶æ„æ„¿æ™¯ (Architecture Vision)

### 2.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Design Principle 1: æ„å»ºä¸æŸ¥è¯¢å®Œå…¨è§£è€¦                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ æ„å»ºå®¹å™¨ï¼šåªè´Ÿè´£æ„å»ºå›¾ï¼Œä¸æ‰§è¡ŒæŸ¥è¯¢                          â”‚
â”‚  â€¢ æŸ¥è¯¢å®¹å™¨ï¼šåªè´Ÿè´£æŸ¥è¯¢ï¼Œä¸æ„å»ºå›¾                              â”‚
â”‚  â€¢ ä¸¤è€…é€šè¿‡æŒä¹…åŒ–å­˜å‚¨é€šä¿¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿ/å¯¹è±¡å­˜å‚¨ï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Design Principle 2: æŸ¥è¯¢å®¹å™¨æ— çŠ¶æ€ä¸”å¯æ¨ªå‘æ‰©å±•                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ æŸ¥è¯¢å®¹å™¨æ˜¯ Serverless Function æ¨¡å¼                        â”‚
â”‚  â€¢ ç”¨æˆ·æä¾› Kotlin DSL ä»£ç ï¼Œå®¹å™¨æ‰§è¡Œå¹¶è¿”å›ç»“æœ                â”‚
â”‚  â€¢ æ”¯æŒå¹¶å‘æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢ï¼ˆN ä¸ªæŸ¥è¯¢å®¹å™¨ â†’ 1 ä¸ªæ„å»ºäº§ç‰©ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Design Principle 3: é…ç½®å³ä»£ç ï¼Œç¯å¢ƒå˜é‡é©±åŠ¨                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ æ„å»ºé…ç½®é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’ï¼ˆGIT_REPO, PASSES, ...ï¼‰          â”‚
â”‚  â€¢ æŸ¥è¯¢å®¹å™¨ä»æŒä¹…åŒ–å­˜å‚¨åŠ è½½é…ç½®ï¼ˆregisteredPassesï¼‰            â”‚
â”‚  â€¢ æ”¯æŒå£°æ˜å¼é…ç½®ï¼ˆYAML/JSONï¼‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç›®æ ‡æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: BUILD (æ„å»ºå®¹å™¨)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Input:                                                    â”‚
â”‚    â€¢ Git Repository URL (ç¯å¢ƒå˜é‡: GIT_REPO)                â”‚
â”‚    â€¢ Branch/Commit (ç¯å¢ƒå˜é‡: GIT_REF)                      â”‚
â”‚    â€¢ Pass Configuration (ç¯å¢ƒå˜é‡: PASSES)                  â”‚
â”‚    â€¢ Language Frontends (ç¯å¢ƒå˜é‡: LANGUAGES)               â”‚
â”‚                                                            â”‚
â”‚  Process:                                                  â”‚
â”‚    1. Clone repository                                     â”‚
â”‚    2. Run TranslationManager with configured passes        â”‚
â”‚    3. Serialize TranslationResult + Config                 â”‚
â”‚                                                            â”‚
â”‚  Output:                                                   â”‚
â”‚    â€¢ graph.cpg (åºåˆ—åŒ–çš„å›¾)                                 â”‚
â”‚    â€¢ config.json (Pass é…ç½® + å…ƒæ•°æ®)                       â”‚
â”‚    â€¢ stats.json (æ„å»ºç»Ÿè®¡ï¼šèŠ‚ç‚¹æ•°ã€è¾¹æ•°ã€è€—æ—¶)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“ (æŒä¹…åŒ–åˆ°å­˜å‚¨)
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Storage    â”‚
                 â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
                 â”‚  â€¢ File Sys â”‚
                 â”‚  â€¢ S3/OSS   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (åŠ è½½)
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: QUERY (æŸ¥è¯¢å®¹å™¨, N å®ä¾‹å¹¶è¡Œ)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Input:                                                    â”‚
â”‚    â€¢ User Query Script (user-query.kts)                    â”‚
â”‚    â€¢ Graph Reference (ç¯å¢ƒå˜é‡: GRAPH_PATH)                 â”‚
â”‚                                                            â”‚
â”‚  Process:                                                  â”‚
â”‚    1. Load TranslationResult from storage                  â”‚
â”‚    2. Validate query script dependencies                   â”‚
â”‚    3. Execute user query (Kotlin DSL)                      â”‚
â”‚                                                            â”‚
â”‚  Output:                                                   â”‚
â”‚    â€¢ query-result.json (æŸ¥è¯¢ç»“æœ)                           â”‚
â”‚    â€¢ logs.txt (æ‰§è¡Œæ—¥å¿—)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æŠ€æœ¯éœ€æ±‚ (Technical Requirements)

### 3.1 æ„å»ºå®¹å™¨éœ€æ±‚

**REQ-BUILD-1: ç¯å¢ƒå˜é‡é…ç½®**
```bash
# å¿…éœ€
GIT_REPO=https://github.com/user/repo.git
GIT_REF=main  # branch, tag, or commit SHA

# Pass é…ç½®ï¼ˆé€—å·åˆ†éš”ï¼‰
PASSES=EvaluationOrderGraphPass,ControlFlowSensitiveDFGPass,UnreachableEOGPass

# è¯­è¨€å‰ç«¯ï¼ˆé€—å·åˆ†éš”ï¼‰
LANGUAGES=java,kotlin

# è¾“å‡ºè·¯å¾„
OUTPUT_PATH=/output/graph.cpg

# å¯é€‰ï¼šæºç è·¯å¾„è¿‡æ»¤
SOURCE_INCLUDES=src/main/**/*.java
SOURCE_EXCLUDES=**/test/**,**/generated/**
```

**REQ-BUILD-2: æ„å»ºäº§ç‰©è§„èŒƒ**

äº§ç‰©å¿…é¡»åŒ…å«ï¼š
1. **å›¾æ•°æ®** (`graph.cpg`)ï¼š
   - æ‰€æœ‰èŠ‚ç‚¹ï¼ˆNodeï¼‰
   - æ‰€æœ‰è¾¹ï¼ˆEOG, DFG, CDG, PDG, Invoke, ...ï¼‰
   - èŠ‚ç‚¹å±æ€§ï¼ˆåŒ…æ‹¬ Pass è®¾ç½®çš„å±æ€§ï¼Œå¦‚ `unreachable`ï¼‰

2. **é…ç½®å…ƒæ•°æ®** (`config.json`)ï¼š
   ```json
   {
     "version": "cpg-8.2.0",
     "registeredPasses": [
       "EvaluationOrderGraphPass",
       "ControlFlowSensitiveDFGPass",
       "UnreachableEOGPass"
     ],
     "languages": ["java", "kotlin"],
     "buildTimestamp": "2025-11-12T10:30:00Z",
     "gitInfo": {
       "repo": "https://github.com/user/repo.git",
       "ref": "main",
       "commit": "a1b2c3d4"
     }
   }
   ```

3. **ç»Ÿè®¡ä¿¡æ¯** (`stats.json`)ï¼š
   ```json
   {
     "nodeCount": 125000,
     "edgeCount": 450000,
     "buildDurationSeconds": 180,
     "linesOfCode": 50000,
     "fileCount": 250
   }
   ```

**REQ-BUILD-3: é”™è¯¯å¤„ç†**
- æ„å»ºå¤±è´¥æ—¶ï¼Œè¿”å›éé›¶é€€å‡ºç 
- è¾“å‡ºè¯¦ç»†é”™è¯¯æ—¥å¿—ï¼ˆstderrï¼‰
- æ”¯æŒéƒ¨åˆ†å¤±è´¥ï¼ˆæŸäº›æ–‡ä»¶è§£æå¤±è´¥ï¼Œä½†ç»§ç»­å…¶ä»–æ–‡ä»¶ï¼‰

### 3.2 æŸ¥è¯¢å®¹å™¨éœ€æ±‚

**REQ-QUERY-1: å›¾åŠ è½½**
```kotlin
// è‡ªåŠ¨ä»æŒä¹…åŒ–å­˜å‚¨åŠ è½½
val result = TranslationResult.load(
    path = System.getenv("GRAPH_PATH"),
    validateConfig = true  // éªŒè¯ Pass é…ç½®å®Œæ•´æ€§
)
```

**REQ-QUERY-2: ç”¨æˆ·æŸ¥è¯¢æ¥å£ï¼ˆKotlin Script æ¨¡å¼ï¼‰**

**ä¸ºä»€ä¹ˆä½¿ç”¨ Kotlin Script (.kts) è€Œä¸æ˜¯æ™®é€š Kotlin (.kt)ï¼Ÿ**

| ç»´åº¦ | Kotlin Script (.kts) | æ™®é€š Kotlin (.kt) | æ¨è |
|------|---------------------|------------------|------|
| **æ‰§è¡Œæ–¹å¼** | ç›´æ¥è¿è¡Œï¼Œæ— éœ€ç¼–è¯‘ | éœ€è¦ç¼–è¯‘æˆ JAR | âœ… .kts |
| **ç”¨æˆ·ä½“éªŒ** | ç±»ä¼¼è„šæœ¬è¯­è¨€ï¼ˆPython/Shellï¼‰| éœ€è¦æ„å»ºç³»ç»Ÿï¼ˆGradleï¼‰| âœ… .kts |
| **åŠ¨æ€åŠ è½½** | è¿è¡Œæ—¶åŠ è½½æ‰§è¡Œ | ç¼–è¯‘æ—¶å›ºåŒ– | âœ… .kts |
| **å¿«é€Ÿè¿­ä»£** | ä¿®æ”¹åç«‹å³æ‰§è¡Œ | ä¿®æ”¹ â†’ ç¼–è¯‘ â†’ æ‰§è¡Œ | âœ… .kts |
| **Serverless å…¼å®¹** | å¤©ç„¶é€‚åˆï¼ˆå‡½æ•°å³ä»£ç ï¼‰| éœ€è¦æ‰“åŒ…æˆ JAR | âœ… .kts |
| **IDE æ”¯æŒ** | IntelliJ å®Œæ•´æ”¯æŒ | IntelliJ å®Œæ•´æ”¯æŒ | âœ… ä¸¤è€…éƒ½å¥½ |
| **ç±»å‹æ£€æŸ¥** | âœ… ç¼–è¯‘æ—¶æ£€æŸ¥ | âœ… ç¼–è¯‘æ—¶æ£€æŸ¥ | âœ… ä¸¤è€…éƒ½å¥½ |

**ç»“è®º**ï¼š.kts æ›´é€‚åˆ"ç”¨æˆ·è‡ªå®šä¹‰æŸ¥è¯¢è„šæœ¬"åœºæ™¯ã€‚

**æŸ¥è¯¢è„šæœ¬** (`user-query.kts`) **æ ¼å¼**ï¼š
```kotlin
// user-query.kts
// æŸ¥è¯¢å®¹å™¨è‡ªåŠ¨æ³¨å…¥ä»¥ä¸‹å˜é‡ï¼š
// - val result: TranslationResult
// - val config: TranslationConfiguration
// - fun output(data: Any)  // è¾“å‡ºç»“æœåˆ° JSON

// ç”¨æˆ·æŸ¥è¯¢é€»è¾‘ï¼ˆçº¯ Kotlin DSLï¼‰
val ifStatements = result.allNodes<IfStatement>()

val unreachableBranches = ifStatements.filter { ifStmt ->
    ifStmt.nextEOGEdges.any { edge ->
        edge is EvaluationOrder && edge.unreachable == true
    }
}

// è¾“å‡ºç»“æœï¼ˆè‡ªåŠ¨è½¬ JSONï¼‰
output(mapOf(
    "totalIfStatements" to ifStatements.size,
    "unreachableBranches" to unreachableBranches.map {
        mapOf(
            "file" to it.location?.artifactLocation?.uri,
            "line" to it.location?.region?.startLine
        )
    }
))
```

**æ‰§è¡Œæµç¨‹**ï¼š
```
1. ç”¨æˆ·ç¼–å†™ user-query.ktsï¼ˆçº¯ä¸šåŠ¡é€»è¾‘ï¼‰
2. ä¸Šä¼ åˆ°æŸ¥è¯¢å®¹å™¨ï¼ˆé€šè¿‡ ConfigMap/Volumeï¼‰
3. æŸ¥è¯¢å®¹å™¨åŠ è½½å›¾ â†’ æ‰§è¡Œè„šæœ¬ â†’ è¾“å‡ºç»“æœ
4. æ— éœ€ç¼–è¯‘ã€æ‰“åŒ…ã€æ„å»º
```

**REQ-QUERY-3: Kotlin Scripting Engine é›†æˆ**

æŸ¥è¯¢å®¹å™¨éœ€è¦é›†æˆ **Kotlin Scripting Host**ï¼š

```kotlin
// query-runner.kt (æŸ¥è¯¢å®¹å™¨å…¥å£)
import kotlin.script.experimental.api.*
import kotlin.script.experimental.jvm.*
import kotlin.script.experimental.host.toScriptSource

fun main() {
    // 1. åŠ è½½å›¾
    val result = TranslationResult.deserialize(System.getenv("GRAPH_PATH"))

    // 2. å‡†å¤‡è„šæœ¬ç¯å¢ƒ
    val scriptEngine = KotlinJvmScriptEngine()
    val scriptContext = ScriptContext(
        providedValues = mapOf(
            "result" to result,
            "config" to result.config,
            "output" to ::outputToJson
        )
    )

    // 3. æ‰§è¡Œç”¨æˆ·è„šæœ¬
    val scriptFile = File(System.getenv("QUERY_SCRIPT"))
    val evalResult = scriptEngine.eval(
        scriptFile.toScriptSource(),
        scriptContext
    )

    // 4. å¤„ç†ç»“æœæˆ–å¼‚å¸¸
    when (evalResult) {
        is ResultWithDiagnostics.Success -> println("Query completed")
        is ResultWithDiagnostics.Failure -> {
            evalResult.reports.forEach { println(it.message) }
            exitProcess(1)
        }
    }
}
```

**ä¾èµ–**ï¼ˆéœ€è¦æ·»åŠ åˆ° build.gradle.ktsï¼‰ï¼š
```kotlin
dependencies {
    implementation("org.jetbrains.kotlin:kotlin-scripting-jvm")
    implementation("org.jetbrains.kotlin:kotlin-scripting-jvm-host")
    implementation("org.jetbrains.kotlin:kotlin-scripting-common")
}
```

**REQ-QUERY-4: Sensitivity éªŒè¯**
```kotlin
// åœ¨æŸ¥è¯¢æ—¶è‡ªåŠ¨éªŒè¯
object FilterUnreachableEOG : AnalysisSensitivity() {
    override fun followEdge(...): Boolean {
        // ä» result.config è¯»å– registeredPasses
        if (UnreachableEOGPass::class !in result.config.registeredPasses.flatten()) {
            throw IllegalStateException(
                "FilterUnreachableEOG requires UnreachableEOGPass, " +
                "but it was not registered during build. " +
                "Registered passes: ${result.config.registeredPasses}"
            )
        }
        return edge !is EvaluationOrder || edge.unreachable != true
    }
}
```

**REQ-QUERY-5: èµ„æºé™åˆ¶**
- æŸ¥è¯¢è¶…æ—¶ï¼šé»˜è®¤ 5 åˆ†é’Ÿï¼ˆå¯é…ç½®ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡ `QUERY_TIMEOUT`ï¼‰
- å†…å­˜é™åˆ¶ï¼šé»˜è®¤ 4GBï¼ˆå¯é…ç½®ï¼Œé€šè¿‡å®¹å™¨èµ„æºé™åˆ¶ï¼‰
- ç»“æœå¤§å°é™åˆ¶ï¼šé»˜è®¤ 100MBï¼ˆå¯é…ç½®ï¼Œé˜²æ­¢ OOMï¼‰
- è„šæœ¬æ‰§è¡Œæ²™ç®±ï¼šé™åˆ¶æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€ç½‘ç»œè®¿é—®ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰

### 3.3 æŒä¹…åŒ–æ–¹æ¡ˆéœ€æ±‚

**ä¸ºä»€ä¹ˆä¸ç”¨ Neo4jï¼Ÿ**

CPG çš„æŸ¥è¯¢æ¨¡å¼ä¸å›¾æ•°æ®åº“çš„è®¾è®¡ç›®æ ‡ä¸åŒ¹é…ï¼š
- âŒ **Neo4j è®¾è®¡ç›®æ ‡**ï¼šæµ…å±‚å…³ç³»æŸ¥è¯¢ï¼ˆç¤¾äº¤ç½‘ç»œã€æ¨èç³»ç»Ÿï¼Œé€šå¸¸ 1-3 è·³ï¼‰
- âœ… **CPG æŸ¥è¯¢éœ€æ±‚**ï¼šæ·±åº¦éå†åˆ†æï¼ˆexecutionPath å¯èƒ½éå†æ•°åƒå±‚ï¼Œé€’å½’å‡½æ•°è°ƒç”¨ï¼‰
- âŒ **Cypher æ€§èƒ½**ï¼šæ·±åº¦æŸ¥è¯¢æ—¶æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼ˆN å±‚æŸ¥è¯¢ = O(degree^N)ï¼‰
- âœ… **å†…å­˜éå†**ï¼šCPG Kotlin DSL åœ¨å†…å­˜ä¸­éå†ï¼Œæ€§èƒ½ç¨³å®šï¼ˆO(N)ï¼‰

**ç»“è®º**ï¼šæ‰€æœ‰æŸ¥è¯¢å¿…é¡»å‘ç”Ÿåœ¨ Kotlin DSLï¼Œå› æ­¤å¿…é¡»å°†å®Œæ•´å›¾åŠ è½½åˆ°å†…å­˜ã€‚

---

**REQ-PERSIST-1: äºŒè¿›åˆ¶åºåˆ—åŒ–è¦æ±‚**

**æ ¸å¿ƒè¦æ±‚**ï¼ˆæ˜ç¡®ï¼‰ï¼š
- âœ… **ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼**ï¼ˆä¸æ˜¯ JSON/YAML ç­‰äººç±»å¯è¯»æ ¼å¼ï¼‰
- âœ… **å¿«é€Ÿåºåˆ—åŒ–/ååºåˆ—åŒ–**ï¼ˆå¤§å‹å›¾ 50K+ èŠ‚ç‚¹ï¼‰
- âœ… **å¤„ç†å¾ªç¯å¼•ç”¨**ï¼ˆCPG å›¾ä¸­å¤§é‡å¾ªç¯å¼•ç”¨ï¼‰
- âœ… **JVM åŸç”Ÿ**ï¼ˆåªåœ¨ Kotlin/JVM ä½¿ç”¨ï¼Œä¸éœ€è¦è·¨è¯­è¨€ï¼‰
- âœ… **æ–‡ä»¶æ ¼å¼ç¨³å®š**ï¼ˆè‡³å°‘åœ¨åŒä¸€ CPG ç‰ˆæœ¬å†…å¯ç”¨ï¼‰

**å€™é€‰åºåˆ—åŒ–åº“**ï¼ˆå¾… Phase 1 è°ƒç ”å†³ç­–ï¼‰ï¼š

| åº“ | ç´§å‡‘æ€§ | é€Ÿåº¦ | å¾ªç¯å¼•ç”¨ | JVM åŸç”Ÿ | æˆç†Ÿåº¦ | å¤‡æ³¨ |
|---|--------|------|---------|---------|--------|------|
| **Kryo** | â­â­â­â­â­ | â­â­â­â­â­ | âœ… è‡ªåŠ¨ | âœ… | â­â­â­â­â­ | æœ€ç´§å‡‘ã€æœ€å¿« |
| **FST** | â­â­â­â­ | â­â­â­â­ | âœ… è‡ªåŠ¨ | âœ… | â­â­â­ | Kryo æ›¿ä»£å“ |
| **Protocol Buffers** | â­â­â­ | â­â­â­ | âŒ éœ€æ‰‹åŠ¨ | âŒ | â­â­â­â­â­ | è·¨è¯­è¨€ï¼ˆä½†ä¸éœ€è¦ï¼‰|
| **Avro** | â­â­â­ | â­â­â­ | âŒ éœ€æ‰‹åŠ¨ | âŒ | â­â­â­â­ | Hadoop ç”Ÿæ€ |
| **Java Serialization** | â­â­ | â­ | âœ… è‡ªåŠ¨ | âœ… | â­â­ | æ€§èƒ½å·®ã€å·²è¿‡æ—¶ |

**è¯„ä¼°ç»´åº¦**ï¼ˆPhase 1 ç¬¬ä¸€æ­¥ï¼‰ï¼š
1. **åŸºå‡†æµ‹è¯•**ï¼š
   - å°å‹å›¾ï¼ˆ<10K èŠ‚ç‚¹ï¼‰ï¼šåºåˆ—åŒ–/ååºåˆ—åŒ–è€—æ—¶ã€æ–‡ä»¶å¤§å°
   - å¤§å‹å›¾ï¼ˆ50K+ èŠ‚ç‚¹ï¼‰ï¼šåºåˆ—åŒ–/ååºåˆ—åŒ–è€—æ—¶ã€æ–‡ä»¶å¤§å°
2. **å¾ªç¯å¼•ç”¨å¤„ç†**ï¼šè‡ªåŠ¨æµ‹è¯• CPG çš„å¾ªç¯å¼•ç”¨åœºæ™¯
3. **å¾€è¿”æµ‹è¯•**ï¼šåºåˆ—åŒ– â†’ ååºåˆ—åŒ– â†’ éªŒè¯å›¾ç»“æ„ä¸€è‡´æ€§
4. **é›†æˆéš¾åº¦**ï¼šä¸ CPG ç°æœ‰ä»£ç é›†æˆçš„å¤æ‚åº¦

**å†³ç­–æ¨è¿Ÿåˆ° Phase 1**ï¼š
- â³ å…·ä½“åº“é€‰å‹éœ€è¦å®é™…æµ‹è¯•æ•°æ®
- â³ ä¼˜å…ˆæµ‹è¯• Kryoï¼ˆç¤¾åŒºæ¨èæœ€å¤šï¼‰
- â³ å¤‡é€‰æ–¹æ¡ˆï¼šFSTï¼ˆå¦‚æœ Kryo æœ‰é—®é¢˜ï¼‰

**REQ-PERSIST-2: æ•°æ®å®Œæ•´æ€§**
- åºåˆ—åŒ–åé‡æ–°åŠ è½½ï¼Œå›¾ç»“æ„å¿…é¡»å®Œå…¨ä¸€è‡´
- æ‰€æœ‰è¾¹çš„å±æ€§å¿…é¡»ä¿ç•™ï¼ˆç‰¹åˆ«æ˜¯ `unreachable`, `branch`, ...ï¼‰
- èŠ‚ç‚¹å¼•ç”¨å¿…é¡»æ­£ç¡®æ¢å¤ï¼ˆé¿å…æ‚¬ç©ºæŒ‡é’ˆï¼‰

---

## 4. äº¤ä»˜ç‰© (Deliverables)

### 4.1 æ–‡æ¡£äº¤ä»˜ç‰©

**æ–‡æ¡£ 8.1: æ¶æ„è®¾è®¡æ–‡æ¡£** (`8.1-æ¶æ„-å®¹å™¨åŒ–è®¾è®¡.md`)
- æ¶æ„å›¾ï¼ˆæ„å»ºå®¹å™¨ + æŸ¥è¯¢å®¹å™¨ + å­˜å‚¨å±‚ï¼‰
- æ•°æ®æµå›¾ï¼ˆGit Repo â†’ æ„å»º â†’ æŒä¹…åŒ– â†’ æŸ¥è¯¢ â†’ ç»“æœï¼‰
- æ¥å£è§„èŒƒï¼ˆç¯å¢ƒå˜é‡ã€æ–‡ä»¶æ ¼å¼ã€APIï¼‰
- åºåˆ—åŒ–æ–¹æ¡ˆè¦æ±‚ï¼ˆäºŒè¿›åˆ¶ã€ç´§å‡‘ã€å€™é€‰åº“å¯¹æ¯”ï¼‰

**æ–‡æ¡£ 8.2: å®ç°æŒ‡å—** (`8.2-å®ç°-åˆ†æ­¥æŒ‡å—.md`)
- Phase 1: åºåˆ—åŒ–/ååºåˆ—åŒ–å®ç°ï¼ˆ2-3 å‘¨ï¼‰
  - Week 1-2: æ ¸å¿ƒåºåˆ—åŒ–åŠŸèƒ½
  - Week 3: ä¼˜åŒ–ä¸ååºåˆ—åŒ–
- Phase 2: å®¹å™¨åŒ–æ‰“åŒ…ï¼ˆ1 å‘¨ï¼‰
- æµ‹è¯•è®¡åˆ’ï¼ˆå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ï¼‰

**æ–‡æ¡£ 8.3: ç”¨æˆ·æ‰‹å†Œ** (`8.3-æ‰‹å†Œ-ä½¿ç”¨æŒ‡å—.md`)
- å¿«é€Ÿå¼€å§‹ï¼ˆ5 åˆ†é’Ÿæ­å»ºï¼‰
- æ„å»ºå®¹å™¨ä½¿ç”¨ç¤ºä¾‹
- æŸ¥è¯¢å®¹å™¨ä½¿ç”¨ç¤ºä¾‹
- å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

**æ–‡æ¡£ 8.4: API å‚è€ƒ** (`8.4-å‚è€ƒ-APIæ–‡æ¡£.md`)
- åºåˆ—åŒ– APIï¼š`TranslationResult.serializeToFile()`
- ååºåˆ—åŒ– APIï¼š`TranslationResult.deserializeFromFile()`
- æŸ¥è¯¢è„šæœ¬ APIï¼š`output()`, `log()`, `abort()`
- ç¯å¢ƒå˜é‡å‚è€ƒ

### 4.2 ä»£ç äº¤ä»˜ç‰©

**ä»£ç  1: åºåˆ—åŒ–/ååºåˆ—åŒ–å®ç°**
```
cpg-core/src/main/kotlin/de/fraunhofer/aisec/cpg/persistence/
â”œâ”€â”€ Serialization.kt          # åºåˆ—åŒ–æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ Deserialization.kt        # ååºåˆ—åŒ–æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ BinaryFormat.kt           # äºŒè¿›åˆ¶æ ¼å¼å®šä¹‰ï¼ˆå–å†³äºé€‰å®šçš„åº“ï¼‰
â””â”€â”€ SerializationConfig.kt    # é…ç½®é€‰é¡¹ï¼ˆå‹ç¼©ã€åˆ†å—ç­‰ï¼‰
```

**ä»£ç  2: å®¹å™¨é•œåƒ**
```
docker/
â”œâ”€â”€ build-container/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ entrypoint.sh
â”‚   â””â”€â”€ config-template.yml
â””â”€â”€ query-container/
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ query-runner.kt
    â””â”€â”€ examples/
        â”œâ”€â”€ find-unreachable-code.kts
        â”œâ”€â”€ taint-analysis.kts
        â””â”€â”€ call-graph.kts
```

**ä»£ç  3: POC ç¤ºä¾‹**
```
examples/containerized-workflow/
â”œâ”€â”€ docker-compose.yml        # ç¼–æ’æ–‡ä»¶
â”œâ”€â”€ build-config.env          # æ„å»ºå®¹å™¨ç¯å¢ƒå˜é‡
â”œâ”€â”€ query-1.kts               # ç¤ºä¾‹æŸ¥è¯¢ 1
â”œâ”€â”€ query-2.kts               # ç¤ºä¾‹æŸ¥è¯¢ 2
â””â”€â”€ README.md                 # å¿«é€Ÿå¼€å§‹æŒ‡å—
```

---

## 5. å…³é”®æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 æŒ‘æˆ˜ 1: å›¾çš„åºåˆ—åŒ–ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰

**é—®é¢˜**ï¼šCPG æ˜¯æœ‰å‘å›¾ï¼Œå­˜åœ¨å¾ªç¯å¼•ç”¨ï¼ˆå¦‚é€’å½’å‡½æ•°è°ƒç”¨ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```kotlin
// æ–¹æ¡ˆ A: ä¸¤é˜¶æ®µåºåˆ—åŒ–
// Phase 1: åºåˆ—åŒ–æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåˆ†é…å…¨å±€ IDï¼‰
val nodeIdMap = mutableMapOf<Node, Long>()
nodes.forEachIndexed { index, node ->
    nodeIdMap[node] = index.toLong()
}

// Phase 2: åºåˆ—åŒ–è¾¹ï¼ˆå¼•ç”¨èŠ‚ç‚¹ IDï¼‰
edges.forEach { edge ->
    proto.addEdge(EdgeProto(
        startId = nodeIdMap[edge.start],
        endId = nodeIdMap[edge.end],
        type = edge::class.simpleName,
        properties = edge.serializeProperties()
    ))
}

// ååºåˆ—åŒ–æ—¶ï¼Œå…ˆæ¢å¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œå†æ¢å¤è¾¹å¼•ç”¨
```

### 5.2 æŒ‘æˆ˜ 2: åºåˆ—åŒ–æ–‡ä»¶è¿‡å¤§

**é—®é¢˜**ï¼šå¤§å‹é¡¹ç›®å¯èƒ½äº§ç”Ÿ GB çº§æ–‡ä»¶ï¼ŒåŠ è½½æ…¢

**è§£å†³æ–¹æ¡ˆ 1: åˆ†å—å­˜å‚¨**
```
graph.cpg/
â”œâ”€â”€ manifest.json        # å…ƒæ•°æ®ï¼ˆèŠ‚ç‚¹æ•°ã€åˆ†å—ä¿¡æ¯ï¼‰
â”œâ”€â”€ nodes/
â”‚   â”œâ”€â”€ chunk-0.pb      # å‰ 10K èŠ‚ç‚¹
â”‚   â”œâ”€â”€ chunk-1.pb      # ä¸‹ 10K èŠ‚ç‚¹
â”‚   â””â”€â”€ ...
â””â”€â”€ edges/
    â”œâ”€â”€ eog.pb          # EOG è¾¹
    â”œâ”€â”€ dfg.pb          # DFG è¾¹
    â””â”€â”€ ...
```

**è§£å†³æ–¹æ¡ˆ 2: å»¶è¿ŸåŠ è½½ï¼ˆLazy Loadingï¼‰**
```kotlin
class LazyTranslationResult(manifest: Manifest) : TranslationResult {
    private val nodeCache = mutableMapOf<Long, Node>()

    override fun getNode(id: Long): Node {
        return nodeCache.getOrPut(id) {
            // ä»ç£ç›˜åŠ è½½å•ä¸ªèŠ‚ç‚¹
            loadNodeFromDisk(id)
        }
    }
}
```

### 5.3 æŒ‘æˆ˜ 3: Pass é…ç½®éªŒè¯

**é—®é¢˜**ï¼šæŸ¥è¯¢æ—¶ä½¿ç”¨ `FilterUnreachableEOG`ï¼Œä½†æ„å»ºæ—¶æœªæ³¨å†Œ `UnreachableEOGPass`

**è§£å†³æ–¹æ¡ˆ**ï¼šè¿è¡Œæ—¶éªŒè¯ï¼ˆREQ-QUERY-3 å·²è¯´æ˜ï¼‰
```kotlin
// åœ¨ Sensitivity åˆå§‹åŒ–æ—¶éªŒè¯
object FilterUnreachableEOG : AnalysisSensitivity() {
    init {
        // åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶éªŒè¯ï¼ˆlazy åˆå§‹åŒ–ï¼‰
        validatePassRegistered(UnreachableEOGPass::class)
    }
}

// è¾…åŠ©å‡½æ•°
fun validatePassRegistered(passClass: KClass<out Pass<*>>) {
    val registered = currentResult.config.registeredPasses.flatten()
    if (passClass !in registered) {
        throw MissingPassException(
            required = passClass.simpleName,
            registered = registered.map { it.simpleName }
        )
    }
}
```

### 5.4 æŒ‘æˆ˜ 4: Kotlin Script Engine é›†æˆ

**é—®é¢˜**ï¼šå¦‚ä½•åœ¨æŸ¥è¯¢å®¹å™¨ä¸­æ‰§è¡Œç”¨æˆ·ä¸Šä¼ çš„ .kts è„šæœ¬ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šé›†æˆ Kotlin Scripting Host

**Step 1: æ·»åŠ ä¾èµ–**
```kotlin
// build.gradle.kts
dependencies {
    implementation("org.jetbrains.kotlin:kotlin-scripting-jvm")
    implementation("org.jetbrains.kotlin:kotlin-scripting-jvm-host")
    implementation("org.jetbrains.kotlin:kotlin-scripting-common")
}
```

**Step 2: å®ç°è„šæœ¬æ‰§è¡Œå™¨**
```kotlin
// QueryScriptExecutor.kt
class QueryScriptExecutor(val result: TranslationResult) {
    private val outputBuffer = mutableListOf<Any>()

    fun executeScript(scriptPath: String): QueryResult {
        val scriptEngine = createKotlinScriptEngine()

        val evalResult = scriptEngine.eval(
            script = File(scriptPath).toScriptSource(),
            compilation = ScriptCompilationConfiguration {
                // å…è®¸è®¿é—® CPG API
                defaultImports(
                    "de.fraunhofer.aisec.cpg.graph.*",
                    "de.fraunhofer.aisec.cpg.query.*"
                )
            },
            evaluation = ScriptEvaluationConfiguration {
                // æ³¨å…¥å˜é‡
                providedProperties(
                    "result" to result,
                    "config" to result.config,
                    "output" to ::recordOutput
                )
            }
        )

        return when (evalResult) {
            is ResultWithDiagnostics.Success ->
                QueryResult(success = true, data = outputBuffer)
            is ResultWithDiagnostics.Failure ->
                QueryResult(success = false, errors = evalResult.reports.map { it.message })
        }
    }

    private fun recordOutput(data: Any) {
        outputBuffer.add(data)
    }
}
```

**Step 3: è„šæœ¬æ²™ç®±ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰**
```kotlin
// é™åˆ¶è„šæœ¬æƒé™
ScriptCompilationConfiguration {
    refineConfiguration {
        // ç¦æ­¢è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼ˆé™¤äº†æŸ¥è¯¢ç»“æœè¾“å‡ºï¼‰
        // ç¦æ­¢ç½‘ç»œè®¿é—®
        // ç¦æ­¢æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
        onAnnotations<DangerousAPI> {
            // æ‹’ç»ç¼–è¯‘
        }
    }
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç”¨æˆ·æ— éœ€ç¼–è¯‘ï¼ˆç›´æ¥æ‰§è¡Œ .ktsï¼‰
- âœ… åŠ¨æ€åŠ è½½ï¼ˆå®¹å™¨å¯åŠ¨æ—¶åŠ è½½è„šæœ¬ï¼‰
- âœ… ç±»å‹å®‰å…¨ï¼ˆè„šæœ¬ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹ï¼‰
- âœ… IDE æ”¯æŒï¼ˆIntelliJ å¯ä»¥ç¼–è¾‘ .kts å¹¶æä¾›ä»£ç è¡¥å…¨ï¼‰

### 5.5 æŒ‘æˆ˜ 5: å¹¶å‘æŸ¥è¯¢çš„éš”ç¦»

**é—®é¢˜**ï¼šå¤šä¸ªæŸ¥è¯¢å®¹å™¨å¹¶å‘è®¿é—®åŒä¸€ä¸ªå›¾ï¼Œå¯èƒ½å†²çª

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **å›¾ä¸å¯å˜**ï¼šåºåˆ—åŒ–åçš„å›¾æ˜¯åªè¯»çš„ï¼ŒæŸ¥è¯¢ä¸ä¿®æ”¹å›¾
- âœ… **æŸ¥è¯¢ç»“æœéš”ç¦»**ï¼šæ¯ä¸ªæŸ¥è¯¢å®¹å™¨æœ‰ç‹¬ç«‹çš„è¾“å‡ºç›®å½•
- âœ… **å†…å­˜éš”ç¦»**ï¼šæ¯ä¸ªæŸ¥è¯¢å®¹å™¨ç‹¬ç«‹è¿›ç¨‹ï¼Œä¸å…±äº«å†…å­˜
- âœ… **è„šæœ¬éš”ç¦»**ï¼šæ¯ä¸ªæŸ¥è¯¢å®¹å™¨æ‰§è¡Œç‹¬ç«‹çš„ .kts æ–‡ä»¶

---

## 6. å®æ–½è·¯çº¿å›¾ (Implementation Roadmap)

**æ€»ä½“æ—¶é—´çº¿**ï¼š3-4 å‘¨

### Phase 1: åºåˆ—åŒ–/ååºåˆ—åŒ–å®ç°ï¼ˆ2-3 å‘¨ï¼‰

**Step 1: åºåˆ—åŒ–åº“è°ƒç ”ä¸é€‰å‹ï¼ˆ2-3 å¤©ï¼‰**
- ğŸ“Š **åŸºå‡†æµ‹è¯•**ï¼ˆä½¿ç”¨çœŸå® CPG å›¾ï¼‰ï¼š
  - å‡†å¤‡æµ‹è¯•æ•°æ®ï¼šå°å‹å›¾ï¼ˆ<10K èŠ‚ç‚¹ï¼‰ã€ä¸­å‹å›¾ï¼ˆ30K èŠ‚ç‚¹ï¼‰ã€å¤§å‹å›¾ï¼ˆ50K+ èŠ‚ç‚¹ï¼‰
  - æµ‹è¯•å€™é€‰åº“ï¼šKryo, FST, Protocol Buffers
  - æµ‹é‡æŒ‡æ ‡ï¼š
    - åºåˆ—åŒ–è€—æ—¶
    - ååºåˆ—åŒ–è€—æ—¶
    - æ–‡ä»¶å¤§å°
    - å†…å­˜å ç”¨
- ğŸ§ª **å¾ªç¯å¼•ç”¨æµ‹è¯•**ï¼š
  - éªŒè¯è‡ªåŠ¨å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆCPG é€’å½’å‡½æ•°ã€äº’ç›¸å¼•ç”¨çš„èŠ‚ç‚¹ï¼‰
  - éªŒè¯å¾€è¿”ä¸€è‡´æ€§ï¼ˆåºåˆ—åŒ– â†’ ååºåˆ—åŒ– â†’ å›¾ç»“æ„å®Œå…¨ä¸€è‡´ï¼‰
- ğŸ“ **é›†æˆéš¾åº¦è¯„ä¼°**ï¼š
  - ä¸ CPG ç°æœ‰ä»£ç é›†æˆçš„å¤æ‚åº¦
  - ä¾èµ–ç®¡ç†ï¼ˆéœ€è¦æ·»åŠ å“ªäº›åº“ï¼‰
- ğŸ¯ **å†³ç­–**ï¼šé€‰æ‹©æœ€åˆé€‚çš„åºåˆ—åŒ–åº“

**äº¤ä»˜ç‰©**ï¼š
- åŸºå‡†æµ‹è¯•æŠ¥å‘Šï¼ˆå¯¹æ¯”è¡¨ï¼šè€—æ—¶ã€æ–‡ä»¶å¤§å°ã€å†…å­˜ï¼‰
- é€‰å‹å†³ç­–æ–‡æ¡£ï¼ˆæ¨èåº“ + ç†ç”±ï¼‰

**Step 2: æ ¸å¿ƒåºåˆ—åŒ–å®ç°ï¼ˆ1 å‘¨ï¼‰**
- ğŸ”§ å®ç° `TranslationResult.serialize()`ï¼š
  - åºåˆ—åŒ–æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå¤„ç†å¾ªç¯å¼•ç”¨ï¼‰
  - åºåˆ—åŒ–æ‰€æœ‰è¾¹ï¼ˆEOG, DFG, CDG, PDG, Invoke, ...ï¼‰
  - åºåˆ—åŒ–é…ç½®å…ƒæ•°æ®ï¼ˆregisteredPasses, languages, gitInfoï¼‰
  - åºåˆ—åŒ–ç»Ÿè®¡ä¿¡æ¯ï¼ˆnodeCount, edgeCount, buildDurationï¼‰
- ğŸ”§ æ–‡ä»¶æ ¼å¼è®¾è®¡ï¼š
  ```
  graph.dump (äºŒè¿›åˆ¶æ–‡ä»¶) æˆ–
  graph.cpg/ (ç›®å½•ç»“æ„)
    â”œâ”€â”€ metadata.bin     # é…ç½® + ç»Ÿè®¡
    â”œâ”€â”€ nodes.bin        # æ‰€æœ‰èŠ‚ç‚¹
    â””â”€â”€ edges.bin        # æ‰€æœ‰è¾¹
  ```
- ğŸ§ª å•å…ƒæµ‹è¯•ï¼š
  - å°å‹å›¾åºåˆ—åŒ–ï¼ˆ<10K èŠ‚ç‚¹ï¼‰
  - éªŒè¯æ–‡ä»¶å¯å†™å…¥
  - éªŒè¯å…ƒæ•°æ®å®Œæ•´

**Step 3: ååºåˆ—åŒ–å®ç°ï¼ˆ1 å‘¨ï¼‰**
- ğŸ”§ å®ç° `TranslationResult.deserialize()`ï¼š
  - è¯»å–å…ƒæ•°æ®
  - é‡å»ºèŠ‚ç‚¹å¯¹è±¡
  - æ¢å¤èŠ‚ç‚¹å¼•ç”¨ï¼ˆå¤„ç†å¾ªç¯å¼•ç”¨ï¼‰
  - æ¢å¤è¾¹è¿æ¥
- ğŸ§ª å¾€è¿”æµ‹è¯•ï¼ˆRoundtrip Testï¼‰ï¼š
  - æ„å»ºå›¾ â†’ åºåˆ—åŒ– â†’ ååºåˆ—åŒ– â†’ éªŒè¯ä¸€è‡´æ€§
  - éªŒè¯èŠ‚ç‚¹æ•°/è¾¹æ•°å®Œå…¨ä¸€è‡´
  - éªŒè¯è¾¹å±æ€§ï¼ˆunreachable, branch, ...ï¼‰å®Œå…¨ä¸€è‡´
  - éªŒè¯èŠ‚ç‚¹å¼•ç”¨æ­£ç¡®ï¼ˆæ— æ‚¬ç©ºæŒ‡é’ˆï¼‰
- ğŸ“Š æ€§èƒ½æµ‹è¯•ï¼š
  - å¤§å‹å›¾ï¼ˆ50K+ èŠ‚ç‚¹ï¼‰åºåˆ—åŒ–/ååºåˆ—åŒ–è€—æ—¶
  - æ–‡ä»¶å¤§å°ç»Ÿè®¡
  - å†…å­˜å ç”¨åˆ†æ

**Step 4: ä¼˜åŒ–ï¼ˆå¯é€‰ï¼Œ3-5 å¤©ï¼‰**
- ğŸ”§ åˆ†å—å­˜å‚¨ï¼ˆå¦‚æœå•æ–‡ä»¶ >1GBï¼‰
- ğŸ”§ å»¶è¿ŸåŠ è½½ï¼ˆå¦‚æœå†…å­˜ >4GBï¼‰
- ğŸ”§ å‹ç¼©ï¼ˆå¦‚æœæ–‡ä»¶è¿‡å¤§ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- åºåˆ—åŒ–/ååºåˆ—åŒ–åº“ï¼ˆ`cpg-persistence` æ¨¡å—ï¼‰
- å•å…ƒæµ‹è¯•å¥—ä»¶ï¼ˆå¾€è¿”æµ‹è¯•ï¼‰
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼ˆè€—æ—¶ã€æ–‡ä»¶å¤§å°ã€å†…å­˜ï¼‰
- åºåˆ—åŒ–æ ¼å¼æ–‡æ¡£ï¼ˆäºŒè¿›åˆ¶æ ¼å¼è§„èŒƒï¼‰

### Phase 2: å®¹å™¨åŒ–æ‰“åŒ…ï¼ˆ1 å‘¨ï¼‰

**Week 4: å®¹å™¨é•œåƒä¸ç¼–æ’**

**4.1 æ„å»ºå®¹å™¨å®ç°**
- ğŸ”§ Dockerfileï¼ˆåŸºäº Gradle JDK 17ï¼‰
  ```dockerfile
  FROM gradle:8.5-jdk17
  WORKDIR /app
  COPY . .
  RUN gradle build
  ENTRYPOINT ["/app/entrypoint.sh"]
  ```
- ğŸ”§ entrypoint.sh
  - è¯»å–ç¯å¢ƒå˜é‡ï¼ˆGIT_REPO, GIT_REF, PASSES, LANGUAGESï¼‰
  - Clone Git ä»“åº“
  - æ‰§è¡Œ TranslationManager æ„å»º
  - åºåˆ—åŒ–è¾“å‡ºåˆ° OUTPUT_PATH
- ğŸ”§ é…ç½®æ¨¡æ¿ï¼ˆconfig-template.ymlï¼‰
  - Pass é…ç½®ç¤ºä¾‹
  - è¯­è¨€å‰ç«¯é…ç½®ç¤ºä¾‹

**4.2 æŸ¥è¯¢å®¹å™¨å®ç°**ï¼ˆé‡ç‚¹ï¼šKotlin Script æ”¯æŒï¼‰
- ğŸ”§ Dockerfileï¼ˆåŒ…å« CPG + Kotlin Scripting Engineï¼‰
  ```dockerfile
  FROM openjdk:17-slim
  COPY cpg-query.jar /app/
  COPY kotlin-scripting-*.jar /app/libs/
  ENTRYPOINT ["java", "-jar", "/app/cpg-query.jar"]
  ```
- ğŸ”§ QueryScriptExecutor.ktï¼ˆè§ Section 5.4ï¼‰
  - é›†æˆ kotlin-scripting-jvm-host
  - è‡ªåŠ¨æ³¨å…¥å˜é‡ï¼ˆresult, config, outputï¼‰
  - ScriptCompilationConfigurationï¼ˆé»˜è®¤ import CPG APIï¼‰
  - ScriptEvaluationConfigurationï¼ˆæä¾›ä¸Šä¸‹æ–‡ï¼‰
  - å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æŠ¥å‘Š
  - è¶…æ—¶æ§åˆ¶ï¼ˆä½¿ç”¨ ExecutorService + Future.get(timeout)ï¼‰
- ğŸ”§ query-runner.ktï¼ˆä¸»å…¥å£ï¼‰
  - åŠ è½½å›¾ï¼šTranslationResult.deserialize()
  - åŠ è½½è„šæœ¬ï¼šè¯»å– QUERY_SCRIPT ç¯å¢ƒå˜é‡
  - æ‰§è¡Œè„šæœ¬ï¼šQueryScriptExecutor.executeScript()
  - è¾“å‡ºç»“æœï¼šJSON æ ¼å¼å†™å…¥ stdout æˆ–æ–‡ä»¶
- ğŸ”§ ç¤ºä¾‹æŸ¥è¯¢è„šæœ¬ï¼ˆ.kts æ ¼å¼ï¼‰ï¼š
  ```
  examples/
  â”œâ”€â”€ find-unreachable-code.kts    # æŸ¥æ‰¾ä¸å¯è¾¾ä»£ç 
  â”œâ”€â”€ taint-analysis.kts           # æ±¡ç‚¹åˆ†æ
  â”œâ”€â”€ call-graph-export.kts        # å¯¼å‡ºè°ƒç”¨å›¾
  â””â”€â”€ security-scan.kts            # å®‰å…¨æ¼æ´æ‰«æ
  ```

**4.3 Docker Compose ç¼–æ’**
- ğŸ”§ docker-compose.yml
  - æ„å»ºå®¹å™¨æœåŠ¡ï¼ˆè¿è¡Œä¸€æ¬¡ï¼Œè¾“å‡ºåˆ°å…±äº«å·ï¼‰
  - æŸ¥è¯¢å®¹å™¨æœåŠ¡ï¼ˆå¯æ‰©å±•å¤šå®ä¾‹ï¼Œé€šè¿‡ scaleï¼‰
  - å…±äº«å·ï¼ˆå­˜å‚¨å›¾æ–‡ä»¶ï¼šgraph.dumpï¼‰
  - ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ.env æ–‡ä»¶ï¼‰
- ğŸ”§ ç¤ºä¾‹é…ç½®
  ```yaml
  services:
    builder:
      image: cpg-builder:v1.0
      volumes:
        - graph-data:/output
      environment:
        - GIT_REPO=${GIT_REPO}
        - PASSES=${PASSES}

    query:
      image: cpg-query:v1.0
      volumes:
        - graph-data:/input:ro      # åªè¯»
        - ./queries:/queries:ro     # ç”¨æˆ·è„šæœ¬
        - ./results:/results        # è¾“å‡ºç›®å½•
      environment:
        - GRAPH_PATH=/input/graph.dump
        - QUERY_SCRIPT=/queries/user-query.kts
      deploy:
        replicas: 3  # å¹¶å‘ 3 ä¸ªæŸ¥è¯¢å®¹å™¨
  ```

**4.4 æ–‡æ¡£ç¼–å†™**
- ğŸ“š ç¼–å†™æ–‡æ¡£
  - å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼ˆ5 åˆ†é’Ÿè¿è¡Œç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼‰
  - æ¶æ„è®¾è®¡æ–‡æ¡£ï¼ˆ8.1-æ¶æ„-å®¹å™¨åŒ–è®¾è®¡.mdï¼‰
  - å®ç°æŒ‡å—ï¼ˆ8.2-å®ç°-åˆ†æ­¥æŒ‡å—.mdï¼‰
  - ç”¨æˆ·æ‰‹å†Œï¼ˆ8.3-æ‰‹å†Œ-ä½¿ç”¨æŒ‡å—.mdï¼‰

**äº¤ä»˜ç‰©**ï¼š
- ç”Ÿäº§çº§å®¹å™¨é•œåƒï¼ˆ`cpg-builder:v1.0`, `cpg-query:v1.0`ï¼‰
- Docker Compose ç¤ºä¾‹
- Kubernetes éƒ¨ç½² YAMLï¼ˆå¯é€‰ï¼‰
- å®Œæ•´æ–‡æ¡£é›†

### Phase 3: ç¤¾åŒºè´¡çŒ®ï¼ˆå¯é€‰ï¼‰

**å‘ CPG å¼€æºé¡¹ç›®æäº¤ PR**ï¼š
- åºåˆ—åŒ–/ååºåˆ—åŒ–åŠŸèƒ½ï¼ˆ`cpg-persistence` æ¨¡å—ï¼‰
- å®¹å™¨åŒ–ç¤ºä¾‹ï¼ˆDockerfile + docker-compose.ymlï¼‰
- æ–‡æ¡£æ›´æ–°ï¼ˆREADME, æ¶æ„è¯´æ˜ï¼‰
- Pass é…ç½®éªŒè¯ï¼ˆSensitivity è¿è¡Œæ—¶æ£€æŸ¥ï¼‰

---

## 7. æˆåŠŸæ ‡å‡† (Success Criteria)

### 7.1 åŠŸèƒ½æ€§æ ‡å‡†

| æ ‡å‡† | éªŒè¯æ–¹æ³• |
|------|---------|
| âœ… æ„å»ºä¸æŸ¥è¯¢å®Œå…¨è§£è€¦ | æ„å»ºå®¹å™¨å’ŒæŸ¥è¯¢å®¹å™¨å¯ä»¥åœ¨ä¸åŒæœºå™¨è¿è¡Œ |
| âœ… å›¾åºåˆ—åŒ–å®Œæ•´æ€§ | åºåˆ—åŒ– â†’ ååºåˆ—åŒ–åï¼ŒèŠ‚ç‚¹æ•°/è¾¹æ•°/å±æ€§å®Œå…¨ä¸€è‡´ |
| âœ… Pass é…ç½®éªŒè¯ | æŸ¥è¯¢æ—¶ä½¿ç”¨æœªæ³¨å†Œ Pass çš„ Sensitivityï¼ŒæŠ›å‡ºæ¸…æ™°é”™è¯¯ |
| âœ… å¹¶å‘æŸ¥è¯¢éš”ç¦» | 10 ä¸ªæŸ¥è¯¢å®¹å™¨å¹¶å‘æŸ¥è¯¢åŒä¸€ä¸ªå›¾ï¼Œç»“æœæ­£ç¡®ä¸”æ— å†²çª |
| âœ… Kotlin Script æ‰§è¡Œ | ç”¨æˆ·å¯ä»¥ç¼–å†™ .kts è„šæœ¬ï¼Œæ— éœ€ç¼–è¯‘å³å¯æ‰§è¡Œ |
| âœ… è„šæœ¬ç±»å‹æ£€æŸ¥ | .kts è„šæœ¬ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹ï¼Œæä¾›æ¸…æ™°é”™è¯¯ |
| âœ… IDE æ”¯æŒ | IntelliJ å¯ä»¥ç¼–è¾‘ .kts å¹¶æä¾›ä»£ç è¡¥å…¨ï¼ˆéªŒè¯ import æ­£ç¡®ï¼‰|

### 7.2 æ€§èƒ½æ ‡å‡†

| æŒ‡æ ‡ | ç›®æ ‡ | éªŒè¯é¡¹ç›® |
|------|------|---------|
| æ„å»ºè€—æ—¶ | â‰¤ å•ä½“è¿è¡Œçš„ 1.2x | 10K LOC é¡¹ç›® |
| åºåˆ—åŒ–è€—æ—¶ | â‰¤ 30 ç§’ | 50K èŠ‚ç‚¹å›¾ |
| ååºåˆ—åŒ–è€—æ—¶ | â‰¤ 60 ç§’ | 50K èŠ‚ç‚¹å›¾ |
| .kts è„šæœ¬å¯åŠ¨ | â‰¤ 5 ç§’ | é¦–æ¬¡ç¼–è¯‘ + åŠ è½½ï¼ˆå«å›¾åŠ è½½æ—¶é—´ï¼‰|
| æŸ¥è¯¢å“åº”æ—¶é—´ | â‰¤ å•ä½“è¿è¡Œçš„ 1.1x | executionPath æŸ¥è¯¢ï¼ˆå›¾å·²åŠ è½½åï¼‰|
| æ–‡ä»¶å¤§å° | â‰¤ 100MB | 10K LOC é¡¹ç›®çš„åºåˆ—åŒ–æ–‡ä»¶ |

### 7.3 æ˜“ç”¨æ€§æ ‡å‡†

| æ ‡å‡† | éªŒè¯æ–¹æ³• |
|------|---------|
| âœ… å¿«é€Ÿå¼€å§‹ | æ–°ç”¨æˆ· 5 åˆ†é’Ÿå†…å®Œæˆç¬¬ä¸€æ¬¡æ„å»º+æŸ¥è¯¢ï¼ˆä½¿ç”¨ç¤ºä¾‹ .ktsï¼‰|
| âœ… è„šæœ¬å³ç”¨ | ç”¨æˆ·ä¿®æ”¹ .kts åï¼Œæ— éœ€é‡æ–°æ„å»ºå®¹å™¨å³å¯æ‰§è¡Œ |
| âœ… é”™è¯¯æç¤ºæ¸…æ™° | æ‰€æœ‰å¸¸è§é”™è¯¯ï¼ˆPass æœªæ³¨å†Œã€è„šæœ¬è¯­æ³•é”™è¯¯ã€...ï¼‰æœ‰æ¸…æ™°æç¤º |
| âœ… æ–‡æ¡£å®Œæ•´ | æ¶æ„è®¾è®¡ã€å®ç°æŒ‡å—ã€ç”¨æˆ·æ‰‹å†Œã€API å‚è€ƒã€.kts ç¤ºä¾‹é½å…¨ |
| âœ… ç¤ºä¾‹ä¸°å¯Œ | è‡³å°‘ 5 ä¸ª .kts æŸ¥è¯¢è„šæœ¬ç¤ºä¾‹ï¼ˆå®‰å…¨ã€è´¨é‡ã€åˆè§„ã€...ï¼‰|

---

## 8. æ‰§è¡Œç­–ç•¥ (Execution Strategy)

### 8.1 Memory-First Approach

**BEFORE æ‰§è¡Œä»»ä½•æ­¥éª¤**ï¼š
1. âœ… Read `tags.json`, `topics.json`
2. âœ… Read ç›¸å…³ semantic notes:
   - `sem-001` (Java CPG Architecture) - ç†è§£ Frontend
   - `sem-003` (UnreachableEOGPass) - ç†è§£ Pass ç³»ç»Ÿ
   - `sem-004` (Query API DSL) - ç†è§£æŸ¥è¯¢æœºåˆ¶
3. âœ… Read ç›¸å…³ episodic notes:
   - `ep-001` (Task 1) - Java Frontend åˆ†æ
   - `ep-002` (Task 2) - Pass ç³»ç»Ÿåˆ†æ
4. âœ… Grep ç°æœ‰æŒä¹…åŒ–ç›¸å…³ä»£ç ï¼š
   - `cpg-core/.../Persistable.kt` - ç†è§£æŒä¹…åŒ–æ¥å£
   - `cpg-core/.../Node.kt` - ç†è§£èŠ‚ç‚¹ç»“æ„ï¼ˆåºåˆ—åŒ–éœ€è¦ï¼‰

### 8.2 Incremental Approach

**æ¯ä¸ªæ–‡æ¡£ <2000 lines context**ï¼š
- Step 1: åˆ›å»º 8.1-æ¶æ„-å®¹å™¨åŒ–è®¾è®¡.mdï¼ˆ~1500 linesï¼‰â†’ Checkpoint
- Step 2: åˆ›å»º 8.2-å®ç°-åˆ†æ­¥æŒ‡å—.mdï¼ˆ~2000 linesï¼‰â†’ Checkpoint
- Step 3: åˆ›å»º 8.3-æ‰‹å†Œ-ä½¿ç”¨æŒ‡å—.mdï¼ˆ~1000 linesï¼‰â†’ Checkpoint
- Step 4: åˆ›å»º 8.4-å‚è€ƒ-APIæ–‡æ¡£.mdï¼ˆ~800 linesï¼‰â†’ Checkpoint
- Step 5: åˆ›å»º POC ä»£ç ç¤ºä¾‹ï¼ˆDockerfile + docker-composeï¼‰â†’ Checkpoint
- Step 6: æœ€ç»ˆå®¡æŸ¥ï¼Œæ›´æ–° episodic note

### 8.3 Memory Update Strategy

**AFTER ä»»åŠ¡å®Œæˆ**ï¼š
1. åˆ›å»º episodic note: `ep-014` (Task 8 execution)
2. åˆ›å»º semantic note: `sem-006` (Containerization Architecture)
3. Update `tags.json`: Add "containerization", "serialization", "build-query-separation"
4. Update `topics.json`: Add "Containerized Architecture" topic

---

## 9. å…³é”®å†³ç­–ç‚¹ (Key Decisions)

### å¾…å†³ç­– 1: åºåˆ—åŒ–åº“é€‰å‹ï¼ˆPhase 1 Step 1ï¼‰

**æ ¸å¿ƒè¦æ±‚**ï¼ˆå·²æ˜ç¡®ï¼‰ï¼š
- âœ… **ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼**ï¼ˆç±»ä¼¼å†…å­˜ dumpï¼Œä¸æ˜¯äººç±»å¯è¯»æ ¼å¼ï¼‰
- âœ… **å¿«é€Ÿåºåˆ—åŒ–/ååºåˆ—åŒ–**ï¼ˆæ¥è¿‘åŸç”Ÿæ€§èƒ½ï¼‰
- âœ… **è‡ªåŠ¨å¤„ç†å¾ªç¯å¼•ç”¨**ï¼ˆCPG å›¾ä¸­å¤§é‡å¾ªç¯ï¼‰
- âœ… **JVM åŸç”Ÿ**ï¼ˆå†…éƒ¨æ ¼å¼ï¼Œä¸éœ€è¦è·¨è¯­è¨€ï¼‰

**å€™é€‰åº“**ï¼ˆå¾…åŸºå‡†æµ‹è¯•ï¼‰ï¼š
- **Kryo**ï¼šç¤¾åŒºæ¨èæœ€å¤šï¼Œæœ€ç´§å‡‘ã€æœ€å¿«
- **FST**ï¼šKryo æ›¿ä»£å“ï¼Œæ€§èƒ½æ¥è¿‘
- **Protocol Buffers**ï¼šè·¨è¯­è¨€æ”¯æŒï¼ˆä½†å¯èƒ½ä¸éœ€è¦ï¼‰

**å†³ç­–æ–¹æ³•**ï¼š
1. å®é™…åŸºå‡†æµ‹è¯•ï¼ˆä½¿ç”¨çœŸå® CPG å›¾ï¼‰
2. æµ‹é‡ï¼šæ–‡ä»¶å¤§å°ã€åºåˆ—åŒ–è€—æ—¶ã€ååºåˆ—åŒ–è€—æ—¶
3. éªŒè¯ï¼šå¾ªç¯å¼•ç”¨å¤„ç†ã€å¾€è¿”ä¸€è‡´æ€§
4. é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ

**å†³ç­–æ—¶é—´**ï¼šPhase 1 Step 1ï¼ˆ2-3 å¤©ï¼‰

### å†³ç­– 2: å®¹å™¨ç¼–æ’æ–¹å¼

**é€‰é¡¹**ï¼š
- A. Docker Composeï¼ˆç®€å•ï¼Œé€‚åˆå¼€å‘ï¼‰
- B. Kubernetesï¼ˆç”Ÿäº§çº§ï¼Œé€‚åˆå¤§è§„æ¨¡ï¼‰
- C. Serverlessï¼ˆAWS Lambda/Google Cloud Runï¼‰

**æ¨è**ï¼š**æä¾› A å’Œ B**
- å¼€å‘ç¯å¢ƒç”¨ Docker Compose
- ç”Ÿäº§ç¯å¢ƒæä¾› Kubernetes YAML + Helm Chart

---

## 10. é£é™©ä¸ç¼“è§£ (Risks and Mitigation)

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| åºåˆ—åŒ–åº“é€‰å‹ä¸å½“ | ä¸­ | é«˜ | Phase 1 Step 1 è¿›è¡Œå……åˆ†åŸºå‡†æµ‹è¯•ï¼Œé€‰æ‹©æœ€ä¼˜åº“ |
| åºåˆ—åŒ–å®ç°å¤æ‚åº¦è¶…é¢„æœŸ | é«˜ | é«˜ | åˆ†é˜¶æ®µå®ç°ï¼ˆè°ƒç ” â†’ æ ¸å¿ƒåŠŸèƒ½ â†’ ä¼˜åŒ–ï¼‰ï¼Œé¢„ç•™ 3 å‘¨ |
| åºåˆ—åŒ–æ–‡ä»¶è¿‡å¤§ï¼ˆ>1GBï¼‰| ä¸­ | ä¸­ | å®ç°å‹ç¼©ï¼ˆDeflate/LZ4ï¼‰+ åˆ†å—å­˜å‚¨ï¼ˆå¯é€‰ï¼‰|
| ååºåˆ—åŒ–åå›¾ç»“æ„ä¸ä¸€è‡´ | ä¸­ | é«˜ | å®Œæ•´çš„å•å…ƒæµ‹è¯• + å¾€è¿”æµ‹è¯•ï¼ˆroundtrip testï¼‰|
| å¾ªç¯å¼•ç”¨å¤„ç†å¤±è´¥ | ä½ | é«˜ | é€‰æ‹©è‡ªåŠ¨å¤„ç†å¾ªç¯å¼•ç”¨çš„åº“ï¼ˆKryo/FSTï¼‰ï¼Œå……åˆ†æµ‹è¯• |
| æŸ¥è¯¢å®¹å™¨å†…å­˜ä¸è¶³ | ä½ | é«˜ | è®¾ç½®å†…å­˜é™åˆ¶ï¼ˆé»˜è®¤ 4GBï¼‰ï¼Œæ”¯æŒåˆ†å—åŠ è½½ |
| ç”¨æˆ·å­¦ä¹ æˆæœ¬é«˜ | ä½ | ä½ | æä¾›ä¸°å¯Œç¤ºä¾‹ + å¿«é€Ÿå¼€å§‹æ–‡æ¡£ï¼ˆ5 åˆ†é’Ÿä¸Šæ‰‹ï¼‰|

---

## 11. é™„å½•ï¼šå‚è€ƒèµ„æ–™

### 11.1 CPG ç›¸å…³æ–‡æ¡£

- `/claude/result/1/1.1-æ¦‚è§ˆ-Javaå‰ç«¯æ¶æ„.md` - Frontend æ¶æ„
- `/claude/result/2/2.1-åŸºç¡€-å›¾ä¸æŸ¥è¯¢.md` - å›¾ç»“æ„ä¸æŸ¥è¯¢ API
- `cpg-core/src/main/kotlin/.../graph/Persistable.kt` - æŒä¹…åŒ–æ¥å£

### 11.2 å¤–éƒ¨èµ„æº

**åºåˆ—åŒ–åº“æ–‡æ¡£**ï¼ˆPhase 1 è°ƒç ”éœ€è¦ï¼‰ï¼š
- [Kryo å®˜æ–¹æ–‡æ¡£](https://github.com/EsotericSoftware/kryo)
- [FST å®˜æ–¹æ–‡æ¡£](https://github.com/RuedigerMoeller/fast-serialization)
- [Protocol Buffers æ–‡æ¡£](https://protobuf.dev/)
- [JVM Serialization Benchmark](https://github.com/eishay/jvm-serializers)

**å®¹å™¨ç¼–æ’æ–‡æ¡£**ï¼š
- [Kubernetes å®¹å™¨ç¼–æ’](https://kubernetes.io/docs/)
- [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/)

### 11.3 ç±»ä¼¼é¡¹ç›®å‚è€ƒ

- **CodeQL**: é¢„ç¼–è¯‘æ•°æ®åº“ï¼ˆ.dbschemeï¼‰ï¼Œç¦»çº¿æŸ¥è¯¢ï¼ˆCodeQL è¯­è¨€ï¼‰- ç±»ä¼¼æˆ‘ä»¬çš„ç›®æ ‡æ¶æ„
- **Soot**: å°† Java bytecode è½¬ä¸º Jimple IRï¼Œæ”¯æŒåºåˆ—åŒ–åˆ°æ–‡ä»¶
- **WALA**: IBM é™æ€åˆ†ææ¡†æ¶ï¼Œæ”¯æŒå†…å­˜å›¾æŒä¹…åŒ–

---

**ä»»åŠ¡çŠ¶æ€**: å¾…æ‰§è¡Œ
**åˆ›å»ºæ—¶é—´**: 2025-11-12
**æœ€åæ›´æ–°**: 2025-11-12
