# Task 9: CPG å…¨é¢å®¡è®¡ï¼ˆåŠ¨æ€é˜Ÿåˆ—æ¶æ„ï¼‰

**ä»»åŠ¡ç±»å‹**: æºç å®¡è®¡ä¸å®ç°éªŒè¯ï¼ˆåŸºäºåŠ¨æ€é˜Ÿåˆ—çš„è‡ªé€‚åº”æ¶æ„ï¼‰
**ä¼˜å…ˆçº§**: P0 (å¿…é¡»å…ˆéªŒè¯ï¼Œå†è§„åˆ’ä¿®å¤)
**é¢„è®¡å·¥ä½œé‡**: æŒ‰æ‰¹æ¬¡æ‰§è¡Œï¼ŒæŒç»­ 1-2 å‘¨ï¼ˆå¯ä¸­æ–­ï¼‰
**ä¾èµ–**: æ‰€æœ‰å†å²æŠ¥å‘Š (Task 1-8) + Memory System çš„æ‰€æœ‰è®°å½•
**è¾“å‡º**: CPG åŠŸèƒ½å®¡è®¡æŠ¥å‘Š + åœºæ™¯éªŒè¯æŠ¥å‘Š + çœŸå® Gap åˆ†æ + ä¿®æ­£çš„ç ”ç©¶è¯¾é¢˜æ¸…å•

---

## ğŸ“ æ–‡ä»¶è·¯å¾„é€ŸæŸ¥ï¼ˆQuick Referenceï¼‰

**âš ï¸ æ‰€æœ‰ Agents å¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ˜ç¡®å®šä¹‰çš„æ–‡ä»¶è·¯å¾„**

### æ ¸å¿ƒçŠ¶æ€æ–‡ä»¶
- **Todolist**: `/home/dai/code/cpg/claude/temp/task-9/todolist.json`
- **Planning Queue**: `/home/dai/code/cpg/claude/temp/task-9/planning_queue.json`
- **ä»»åŠ¡æ¸…å•**: `/home/dai/code/cpg/claude/temp/task-9/task-breakdown.md`

### ä¸´æ—¶æŠ¥å‘Šæ–‡ä»¶
- **Planning Reports**: `/home/dai/code/cpg/claude/temp/task-9/planning-<N>-report.md`
  - ç¤ºä¾‹: `planning-1-report.md`, `planning-2-report.md`
- **Execution Reports**: `/home/dai/code/cpg/claude/temp/task-9/report-task-<task-id>.md`
  - ç¤ºä¾‹: `report-task-1.md`, `report-task-76.md`

### æœ€ç»ˆæŠ¥å‘Šæ–‡ä»¶
- **CPG åŠŸèƒ½å®¡è®¡æŠ¥å‘Š**: `/home/dai/code/cpg/claude/result/9/CPGåŠŸèƒ½å®¡è®¡æŠ¥å‘Š.md`
- **åœºæ™¯éªŒè¯æŠ¥å‘Š**: `/home/dai/code/cpg/claude/result/9/åœºæ™¯éªŒè¯æŠ¥å‘Š.md`
- **çœŸå® Gap åˆ†æ**: `/home/dai/code/cpg/claude/result/9/çœŸå®Gapåˆ†æ.md`
- **ä¿®æ­£çš„ç ”ç©¶è¯¾é¢˜æ¸…å•**: `/home/dai/code/cpg/claude/result/9/ä¿®æ­£çš„ç ”ç©¶è¯¾é¢˜æ¸…å•.md`

è¯¦ç»†è§„èŒƒè§ Section 2.4ã€‚

---

## 1. æ ¸å¿ƒé—®é¢˜é™ˆè¿° (Problem Statement)

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å…¨é¢å®¡è®¡ï¼Ÿ

**å…³é”®å‘ç°**ï¼šè¿‡å»çš„æŠ¥å‘Šå’Œè®°å¿†ç³»ç»Ÿ**å¯èƒ½å­˜åœ¨ç³»ç»Ÿæ€§åå·®**ï¼ŒåŸºäºå‡è®¾è€Œéæºç éªŒè¯ã€‚

**åˆæ­¥è¯æ®**ï¼š

```kotlin
// è¯æ® 1: CPG å·²æœ‰è°ƒç”¨å›¾åŸºç¡€
// cpg-core/src/test/kotlin/.../InvokeTest.kt:42
call.invokes += func  // CallExpression â†’ FunctionDeclaration
assertEquals(1, func.calledByEdges.size)  // é•œåƒè¾¹å­˜åœ¨

// è¯æ® 2: CPG å·²æœ‰è¿‡ç¨‹é—´ DFG
// cpg-core/src/main/kotlin/.../DFGPass.kt:82-93
arg.prevDFGEdges.addContextSensitive(
    param,
    callingContext = CallingContextOut(call),  // ä¸Šä¸‹æ–‡æ•æ„Ÿï¼
)

// è¯æ® 3: CPG å·²æœ‰ Function Summaries
// cpg-core/src/main/kotlin/.../DFGPass.kt:51-52
log.info("Function summaries database has {} entries",
    config.functionSummaries.functionToDFGEntryMap.size)
```

**æ ¸å¿ƒé—®é¢˜**ï¼š
- âŒ Task 4 å£°ç§°"D3 (Interprocedural DFG Missing)"ï¼Œä½† CPG å·²æœ‰åŸºç¡€å®ç°
- âŒ Task 4 å£°ç§°"D4 (Call Graph Infrastructure Missing)"ï¼Œä½† CPG å·²æœ‰ invokes è¾¹
- âŒ å…¶ä»–æŠ¥å‘Šå’Œ Memory ä¸­çš„å£°æ˜å¯èƒ½ä¹Ÿæœ‰ç±»ä¼¼åå·®

### 1.2 å®¡è®¡èŒƒå›´ï¼ˆä¸é™åˆ¶ï¼‰

**éªŒè¯å¯¹è±¡**ï¼ˆç”± Planning Subagent åŠ¨æ€ç¡®å®šï¼‰ï¼š

1. **æ‰€æœ‰å†å²æŠ¥å‘Š** (`/claude/result/1-8/`)
   - æ‰€æœ‰æŠ€æœ¯å£°æ˜ï¼ˆ"CPG æœ‰ X"ã€"CPG ç¼ºå°‘ Y"ã€"CPG ä½¿ç”¨ Z"ï¼‰
   - æ‰€æœ‰æ¶æ„åˆ†æ
   - æ‰€æœ‰ç¼ºé™·è¯†åˆ«

2. **Memory System çš„æ‰€æœ‰è®°å½•** (`/claude/memory/`)
   - Semantic notesï¼ˆç¨³å®šçŸ¥è¯†ï¼Œå¯èƒ½æœ‰åå·®ï¼‰
   - Episodic notesï¼ˆä»»åŠ¡å†å²ï¼Œå¯èƒ½æœ‰é—æ¼ï¼‰
   - Procedural notesï¼ˆå·¥ä½œæµç¨‹ï¼Œå¯èƒ½æœ‰æ”¹è¿›ç©ºé—´ï¼‰

3. **æœªè¢«æŠ¥å‘Šæåˆ°çš„é¢†åŸŸ**ï¼ˆæ¢ç´¢ï¼‰
   - æŠ¥å‘Šä¸­æœªåˆ†æçš„ CPG Pass
   - æŠ¥å‘Šä¸­æœªæåˆ°çš„ CPG åŠŸèƒ½
   - æŠ¥å‘Šä¸­æœªè¦†ç›–çš„æµ‹è¯•é¢†åŸŸ

**é¢„è®¡ä»»åŠ¡æ•°é‡**: **60-120 ä¸ª**ï¼ˆç”± Planning Subagent åŠ¨æ€ç¡®å®šï¼Œä¸é™åˆ¶ä¸Šé™ï¼‰

---

## 2. æ‰§è¡Œæ¶æ„ (Dynamic Queue Architecture)

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: åˆå§‹è§„åˆ’                                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ [Initial Planning Subagent]                        â”‚
â”‚ 1. è¯»å–æ‰€æœ‰æŠ¥å‘Š + Memory Systemï¼ˆä¸é™åˆ¶è¯»å–é‡ï¼‰    â”‚
â”‚ 2. æå–éªŒè¯ä»»åŠ¡ï¼ˆ50-80 ä¸ªï¼‰                         â”‚
â”‚ 3. è¯†åˆ«æ¢ç´¢ä»»åŠ¡ï¼ˆ10-30 ä¸ªï¼‰                         â”‚
â”‚ 4. åˆ›å»ºåˆå§‹ todolist.json                          â”‚
â”‚ 5. åˆ›å»º planning_queue.jsonï¼ˆå¯èƒ½æœ‰åç»­è§„åˆ’ä»»åŠ¡ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: åŠ¨æ€æ‰§è¡Œï¼ˆä¸¤ä¸ªé˜Ÿåˆ—äº¤æ›¿ï¼‰                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ [Main Agent - Queue Manager]                      â”‚
â”‚                                                    â”‚
â”‚ å¾ªç¯æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š                                  â”‚
â”‚                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Planning Queue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ å¦‚æœ planning_queue ä¸ä¸ºç©º:           â”‚          â”‚
â”‚ â”‚   1. å–å‡ºä¸‹ä¸€ä¸ª Planning Task         â”‚          â”‚
â”‚ â”‚   2. å¯åŠ¨ Planning Subagentï¼ˆä¸²è¡Œï¼‰   â”‚          â”‚
â”‚ â”‚   3. Planning Subagent å¯èƒ½:          â”‚          â”‚
â”‚ â”‚      - æ·»åŠ æ–°ä»»åŠ¡åˆ° todolist          â”‚          â”‚
â”‚ â”‚      - æ·»åŠ æ–° Planning Task åˆ°é˜Ÿåˆ—    â”‚          â”‚
â”‚ â”‚   4. æ›´æ–° todolist å’Œ planning_queue  â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Execution Queue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ å¦‚æœ execution_queue ä¸ä¸ºç©º:          â”‚          â”‚
â”‚ â”‚   1. è¯»å–ä¸‹ä¸€æ‰¹ 5 ä¸ª Execution Tasks  â”‚          â”‚
â”‚ â”‚   2. å¯åŠ¨ 5 ä¸ª Execution Subagents    â”‚          â”‚
â”‚ â”‚      ï¼ˆå¹¶è¡Œï¼‰                         â”‚          â”‚
â”‚ â”‚   3. æ”¶é›† 5 ä¸ªå°æŠ¥å‘Š                  â”‚          â”‚
â”‚ â”‚   4. æ›´æ–° todolistï¼ˆåªè¯»ï¼‰            â”‚          â”‚
â”‚ â”‚   5. Checkpoint                       â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                    â”‚
â”‚ é‡å¤å¾ªç¯ï¼Œç›´åˆ°ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ä¸ºç©º                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: æœ€ç»ˆæ±‡æ€»                                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ [Synthesis Subagent]                               â”‚
â”‚ 1. å¢é‡è¯»å–æ‰€æœ‰å°æŠ¥å‘Š                              â”‚
â”‚ 2. äº§å‡º 4 ä¸ªæœ€ç»ˆæŠ¥å‘Š                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¸¤ä¸ªé˜Ÿåˆ—çš„è®¾è®¡

**Planning Queue**ï¼ˆè§„åˆ’é˜Ÿåˆ—ï¼‰:
- **æ‰§è¡Œæ–¹å¼**: **ä¸²è¡Œæ‰§è¡Œ**ï¼ˆé¿å… todolist å¹¶å‘å†™å†²çªï¼‰
- **èŒè´£**: è§„åˆ’æ–°ä»»åŠ¡ï¼ŒåŠ¨æ€æ·»åŠ åˆ° todolist
- **ç‰¹ç‚¹**: å¯ä»¥è¯»å–å¤§é‡æ–‡ä»¶ï¼ˆä¸é™åˆ¶ï¼‰ï¼Œä¸»è¦ä¸ºäº†å¸è½½ Main Agent çš„ context
- **æ•°é‡**: åŠ¨æ€ï¼ˆå¯èƒ½ 1 ä¸ªã€5 ä¸ªã€ç”šè‡³ 10 ä¸ªï¼Œå–å†³äºå‘ç°ï¼‰

**Execution Queue**ï¼ˆæ‰§è¡Œé˜Ÿåˆ—ï¼‰:
- **æ‰§è¡Œæ–¹å¼**: **æ‰¹å¤„ç†å¹¶è¡Œ**ï¼ˆæ¯æ‰¹ 5 ä¸ªï¼‰
- **èŒè´£**: æ‰§è¡Œå…·ä½“çš„éªŒè¯/æ¢ç´¢ä»»åŠ¡ï¼Œäº§å‡ºå°æŠ¥å‘Š
- **ç‰¹ç‚¹**: åªè¯» todolistï¼ˆä¸ä¿®æ”¹ï¼‰
- **æ•°é‡**: 60-120 ä¸ªï¼ˆç”± Planning Subagents åŠ¨æ€æ·»åŠ ï¼‰

### 2.3 Subagent åˆ†ç±»

**ç±»å‹ 1: Planning Subagentï¼ˆè§„åˆ’å‹ï¼‰**
- **èŒè´£**:
  - è¯»å–æŠ¥å‘Š/Memory/æºç ï¼ˆ**ä¸é™åˆ¶è¯»å–é‡**ï¼‰
  - æå–éœ€è¦éªŒè¯çš„å£°æ˜
  - è¯†åˆ«éœ€è¦æ¢ç´¢çš„é¢†åŸŸ
  - **åŠ¨æ€æ·»åŠ **ä»»åŠ¡åˆ° todolist
  - å¯èƒ½æ·»åŠ æ–°çš„ Planning Task åˆ° planning_queue
- **æ‰§è¡Œæ–¹å¼**: **ä¸²è¡Œæ‰§è¡Œ**ï¼ˆé˜Ÿåˆ—ï¼Œé¿å…å¹¶å‘å†™ï¼‰
- **Context**: ä¸é™åˆ¶ï¼ˆå¯èƒ½ 10K-20K è¡Œï¼Œä¸»è¦ä¸ºäº†å¸è½½ contextï¼‰
- **æ•°é‡**: åŠ¨æ€ï¼ˆ1-10 ä¸ªï¼Œå–å†³äºå‘ç°ï¼‰

**ç±»å‹ 2: Execution Subagentï¼ˆæ‰§è¡Œå‹ï¼‰**
- **èŒè´£**:
  - æ‰§è¡Œå•ä¸ªéªŒè¯/æ¢ç´¢ä»»åŠ¡
  - å®šä½æºç ï¼Œé˜…è¯»å®ç°ï¼Œè¯„ä¼°ç¨‹åº¦
  - äº§å‡ºå•ä¸ªå°æŠ¥å‘Š
  - **åªè¯»** todolistï¼ˆä¸ä¿®æ”¹ï¼‰
- **æ‰§è¡Œæ–¹å¼**: **æ‰¹å¤„ç†å¹¶è¡Œ**ï¼ˆæ¯æ‰¹ 5 ä¸ªï¼‰
- **Context**: <3000 è¡Œ
- **æ•°é‡**: 60-120 ä¸ªï¼ˆç”± Planning Subagents ç¡®å®šï¼‰

**ç±»å‹ 3: Synthesis Subagentï¼ˆæ±‡æ€»å‹ï¼‰**
- **èŒè´£**: æ±‡æ€»æ‰€æœ‰å°æŠ¥å‘Šï¼Œäº§å‡ºæœ€ç»ˆæŠ¥å‘Š
- **æ‰§è¡Œæ–¹å¼**: å•ä¸ªï¼Œæœ€åæ‰§è¡Œ
- **Context**: å¢é‡è¯»å–ï¼ˆæ¯æ‰¹ 10 ä¸ªæŠ¥å‘Šï¼‰
- **æ•°é‡**: 1 ä¸ª

---

## 2.4 æ–‡ä»¶åè§„èŒƒï¼ˆFile Naming Conventionï¼‰

**âš ï¸ é‡è¦**: æ‰€æœ‰ Subagents å’Œ Main Agent å¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ˜ç¡®å®šä¹‰çš„æ–‡ä»¶åã€‚

### 2.4.1 æ ¸å¿ƒçŠ¶æ€æ–‡ä»¶ï¼ˆCore State Filesï¼‰

**1. Todolist æ–‡ä»¶**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/temp/task-9/todolist.json`
- **ç”¨é€”**: åŠ¨æ€ä»»åŠ¡æ¸…å•ï¼ˆæ‰€æœ‰ Execution Tasksï¼‰
- **è¯»å†™æƒé™**:
  - Planning Subagents: **è¯»å†™**ï¼ˆå¯æ·»åŠ æ–°ä»»åŠ¡ï¼‰
  - Execution Subagents: **åªè¯»**ï¼ˆä¸ä¿®æ”¹ï¼‰
  - Main Agent: **è¯»å†™**ï¼ˆæ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼‰
- **Schema**: è§ Section 3.5

**2. Planning Queue æ–‡ä»¶**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/temp/task-9/planning_queue.json`
- **ç”¨é€”**: è§„åˆ’é˜Ÿåˆ—ï¼ˆæ‰€æœ‰ Planning Tasksï¼‰
- **è¯»å†™æƒé™**:
  - Planning Subagents: **è¯»å†™**ï¼ˆå¯æ·»åŠ æ–° Planning Tasksï¼‰
  - Main Agent: **è¯»å†™**ï¼ˆæ›´æ–° Planning Task çŠ¶æ€ï¼‰
- **Schema**: è§ Section 3.5

**3. ä»»åŠ¡æ¸…å•ï¼ˆäººç±»å¯è¯»ï¼‰**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/temp/task-9/task-breakdown.md`
- **ç”¨é€”**: äººç±»å¯è¯»çš„ä»»åŠ¡æ¸…å•ï¼ˆåˆå§‹è§„åˆ’äº§å‡ºï¼‰
- **æ›´æ–°**: åªåœ¨ Phase 1 åˆ›å»ºï¼Œåç»­ä¸æ›´æ–°

### 2.4.2 ä¸´æ—¶æŠ¥å‘Šæ–‡ä»¶ï¼ˆTemporary Reportsï¼‰

**Planning Reports**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/temp/task-9/planning-<N>-report.md`
- **å‘½åè§„åˆ™**: `planning-1-report.md`, `planning-2-report.md`, ...
- **ç”¨é€”**: Planning Subagent çš„è§„åˆ’æŠ¥å‘Šï¼ˆè®°å½•å‘ç°å’Œæ·»åŠ çš„ä»»åŠ¡ï¼‰
- **äº§å‡ºè€…**: Planning Subagents
- **å¤§å°**: 500-1000 è¡Œ

**Execution Reports**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/temp/task-9/report-task-<task-id>.md`
- **å‘½åè§„åˆ™**: `report-task-1.md`, `report-task-2.md`, `report-task-76.md`, ...
- **ç”¨é€”**: Execution Subagent çš„éªŒè¯/æ¢ç´¢æŠ¥å‘Š
- **äº§å‡ºè€…**: Execution Subagents
- **å¤§å°**: 200-500 è¡Œ
- **é‡è¦**: ä½¿ç”¨ `task-id`ï¼ˆä» todolistï¼‰ï¼Œè€Œéé¡ºåºç¼–å·

### 2.4.3 æœ€ç»ˆæŠ¥å‘Šæ–‡ä»¶ï¼ˆFinal Reportsï¼‰

**1. CPG åŠŸèƒ½å®¡è®¡æŠ¥å‘Š**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/result/9/CPGåŠŸèƒ½å®¡è®¡æŠ¥å‘Š.md`
- **äº§å‡ºè€…**: Synthesis Subagent
- **å¤§å°**: 3000-4000 è¡Œ

**2. åœºæ™¯éªŒè¯æŠ¥å‘Š**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/result/9/åœºæ™¯éªŒè¯æŠ¥å‘Š.md`
- **äº§å‡ºè€…**: Synthesis Subagent
- **å¤§å°**: 1000-1500 è¡Œ

**3. çœŸå® Gap åˆ†æ**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/result/9/çœŸå®Gapåˆ†æ.md`
- **äº§å‡ºè€…**: Synthesis Subagent
- **å¤§å°**: 800-1200 è¡Œ

**4. ä¿®æ­£çš„ç ”ç©¶è¯¾é¢˜æ¸…å•**
- **æ–‡ä»¶è·¯å¾„**: `/home/dai/code/cpg/claude/result/9/ä¿®æ­£çš„ç ”ç©¶è¯¾é¢˜æ¸…å•.md`
- **äº§å‡ºè€…**: Synthesis Subagent
- **å¤§å°**: 500-1000 è¡Œ

### 2.4.4 æ–‡ä»¶åä½¿ç”¨ç¤ºä¾‹

**Main Agent è¯»å– todolist**:
```python
todolist = read_json("/home/dai/code/cpg/claude/temp/task-9/todolist.json")
```

**Main Agent è¯»å– planning_queue**:
```python
planning_queue = read_json("/home/dai/code/cpg/claude/temp/task-9/planning_queue.json")
```

**Execution Subagent äº§å‡ºæŠ¥å‘Š**:
```python
# ä» todolist è¯»å– task_id = "task-15"
output_path = f"/home/dai/code/cpg/claude/temp/task-9/report-task-15.md"
write_file(output_path, report_content)
```

**Planning Subagent äº§å‡ºæŠ¥å‘Š**:
```python
# Planning Task ID = "planning-2"
output_path = "/home/dai/code/cpg/claude/temp/task-9/planning-2-report.md"
write_file(output_path, report_content)
```

**Planning Subagent æ›´æ–° todolist**:
```python
# è¯»å–
todolist = read_json("/home/dai/code/cpg/claude/temp/task-9/todolist.json")

# æ·»åŠ æ–°ä»»åŠ¡
todolist["tasks"].append({
    "id": "task-76",
    "type": "verification",
    ...
})
todolist["total_tasks"] = 78

# å†™å›
write_json("/home/dai/code/cpg/claude/temp/task-9/todolist.json", todolist)
```

### 2.4.5 æ–‡ä»¶åé€ŸæŸ¥è¡¨

| æ–‡ä»¶ç±»å‹ | æ–‡ä»¶è·¯å¾„ | äº§å‡ºè€… | è¯»å†™æƒé™ |
|---------|---------|--------|---------|
| **Todolist** | `/home/dai/code/cpg/claude/temp/task-9/todolist.json` | Initial Planning | Planningè¯»å†™, Executionåªè¯», Mainè¯»å†™ |
| **Planning Queue** | `/home/dai/code/cpg/claude/temp/task-9/planning_queue.json` | Initial Planning | Planningè¯»å†™, Mainè¯»å†™ |
| **ä»»åŠ¡æ¸…å•** | `/home/dai/code/cpg/claude/temp/task-9/task-breakdown.md` | Initial Planning | åªåœ¨Phase 1åˆ›å»º |
| **Planning Report** | `/home/dai/code/cpg/claude/temp/task-9/planning-<N>-report.md` | Planning Subagents | Planningäº§å‡º |
| **Execution Report** | `/home/dai/code/cpg/claude/temp/task-9/report-task-<task-id>.md` | Execution Subagents | Executionäº§å‡º |
| **å®¡è®¡æŠ¥å‘Š** | `/home/dai/code/cpg/claude/result/9/CPGåŠŸèƒ½å®¡è®¡æŠ¥å‘Š.md` | Synthesis | Synthesisäº§å‡º |
| **åœºæ™¯æŠ¥å‘Š** | `/home/dai/code/cpg/claude/result/9/åœºæ™¯éªŒè¯æŠ¥å‘Š.md` | Synthesis | Synthesisäº§å‡º |
| **Gapåˆ†æ** | `/home/dai/code/cpg/claude/result/9/çœŸå®Gapåˆ†æ.md` | Synthesis | Synthesisäº§å‡º |
| **ç ”ç©¶è¯¾é¢˜** | `/home/dai/code/cpg/claude/result/9/ä¿®æ­£çš„ç ”ç©¶è¯¾é¢˜æ¸…å•.md` | Synthesis | Synthesisäº§å‡º |

---

## 3. Phase 1: åˆå§‹è§„åˆ’ (Initial Planning Subagent)

### 3.1 Initial Planning Subagent çš„ä»»åŠ¡

**ç›®æ ‡**: åˆ›å»ºåˆå§‹çš„ todolist å’Œ planning_queue

**è¾“å…¥**:
1. **æ‰€æœ‰å†å²æŠ¥å‘Š** (`/claude/result/1-8/`)
2. **Memory System çš„æ‰€æœ‰è®°å½•** (`/claude/memory/`)

**æ‰§è¡Œæ­¥éª¤**:

**Step 1: è¯»å–æ‰€æœ‰æŠ¥å‘Šå’Œ Memory**ï¼ˆ**ä¸é™åˆ¶è¯»å–é‡**ï¼‰
- ä½¿ç”¨ Memory-First åŸåˆ™
- è¯»å–æ‰€æœ‰ semantic notesï¼ˆ4 ä¸ªï¼‰
- è¯»å–æ‰€æœ‰ episodic notesï¼ˆ20 ä¸ªï¼‰
- æµè§ˆ Task 1-8 çš„è¾“å‡ºï¼ˆäº†è§£å£°æ˜ï¼‰
- **Context**: å¯èƒ½ 10K-20K è¡Œï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸»è¦ä¸ºäº†å¸è½½ Main Agent çš„ contextï¼‰

**Step 2: æå–åˆå§‹éªŒè¯ä»»åŠ¡**
- éå†æ‰€æœ‰æŠ¥å‘Šå’Œ notes
- æå–æ‰€æœ‰æŠ€æœ¯å£°æ˜
- ä¸ºæ¯ä¸ªå£°æ˜åˆ›å»ºéªŒè¯ä»»åŠ¡
- **é¢„è®¡**: 50-80 ä¸ªéªŒè¯ä»»åŠ¡

**Step 3: è¯†åˆ«åˆå§‹æ¢ç´¢ä»»åŠ¡**
- ç´¢å¼• CPG æºç ï¼ˆGlob åˆ—å‡ºæ‰€æœ‰ Passï¼‰
- å¯¹æ¯”æŠ¥å‘Šä¸­å·²åˆ†æ vs å®é™…å­˜åœ¨
- ä¸ºæ¯ä¸ªæœªåˆ†æçš„é¢†åŸŸåˆ›å»ºæ¢ç´¢ä»»åŠ¡
- **é¢„è®¡**: 10-30 ä¸ªæ¢ç´¢ä»»åŠ¡

**Step 4: è¯†åˆ«éœ€è¦åç»­è§„åˆ’çš„é¢†åŸŸ**
- æŸäº›é¢†åŸŸå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„è§„åˆ’
- ä¾‹å¦‚ï¼šå‘ç° CPG æœ‰ 20 ä¸ª Passï¼Œä½†åªæœ‰ 5 ä¸ªè¢«æŠ¥å‘Šåˆ†æ
- å‰©ä½™ 15 ä¸ª Pass éœ€è¦è¿›ä¸€æ­¥è§„åˆ’ï¼ˆå¯èƒ½æ‹†åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼‰
- åˆ›å»ºåç»­ Planning Task æ·»åŠ åˆ° planning_queue

**Step 5: åˆ›å»ºåˆå§‹ todolist å’Œé˜Ÿåˆ—**
- **todolist.json**: åˆå§‹ä»»åŠ¡æ¸…å•ï¼ˆ60-110 ä¸ªä»»åŠ¡ï¼‰
- **planning_queue.json**: åç»­è§„åˆ’ä»»åŠ¡ï¼ˆ0-10 ä¸ªï¼Œå¯èƒ½ä¸ºç©ºï¼‰

**è¾“å‡º**:
1. **Todolist**: `/home/dai/code/cpg/claude/temp/task-9/todolist.json` - åŠ¨æ€ä»»åŠ¡æ¸…å•
2. **Planning Queue**: `/home/dai/code/cpg/claude/temp/task-9/planning_queue.json` - è§„åˆ’é˜Ÿåˆ—
3. **ä»»åŠ¡æ¸…å•**: `/home/dai/code/cpg/claude/temp/task-9/task-breakdown.md` - äººç±»å¯è¯»çš„ä»»åŠ¡æ¸…å•

### 3.2 Initial Planning Subagent Prompt Template

```markdown
You are the **Initial Planning Subagent** for Task 9: CPG å…¨é¢å®¡è®¡.

**Your Mission**: åˆ›å»ºåˆå§‹çš„ todolist å’Œ planning_queueã€‚

---

## Context

ä½ éœ€è¦å®¡è®¡çš„å¯¹è±¡åŒ…æ‹¬ï¼š
1. **æ‰€æœ‰å†å²æŠ¥å‘Š** (`/claude/result/1-8/`)
2. **Memory System çš„æ‰€æœ‰è®°å½•** (`/claude/memory/`)
3. **CPG æºç **ï¼ˆç´¢å¼•æ‰€æœ‰ Pass å’ŒåŠŸèƒ½ï¼‰

**é‡è¦**: ä½ å¯ä»¥**ä¸é™åˆ¶åœ°è¯»å–æ–‡ä»¶**ã€‚ä½ çš„ä¸»è¦ç›®çš„æ˜¯å¸è½½ Main Agent çš„ contextï¼Œæ‰€ä»¥å³ä½¿è¯»å– 10K-20K è¡Œä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚

---

## Your Tasks

### Task 1: è¯»å–æ‰€æœ‰æŠ¥å‘Šå’Œ Memoryï¼ˆä¸é™åˆ¶ï¼‰

1. è¯»å– Memory indexesï¼ˆtags.json, topics.jsonï¼‰
2. è¯»å–æ‰€æœ‰ semantic notesï¼ˆsem-001 to sem-005ï¼‰
3. è¯»å–æ‰€æœ‰ episodic notesï¼ˆep-001 to ep-020ï¼‰
4. è¯»å– Task 4 çš„ç¼ºé™·æ¸…å•ï¼ˆè¯¦ç»†ï¼‰
5. æµè§ˆ Task 1-8 çš„è¾“å‡ºï¼ˆäº†è§£æ‰€æœ‰æŠ€æœ¯å£°æ˜ï¼‰

**Context Budget**: **ä¸é™åˆ¶**ï¼ˆ10K-20K è¡Œéƒ½å¯ä»¥ï¼‰

### Task 2: æå–éªŒè¯ä»»åŠ¡

**éå†æ‰€æœ‰æŠ¥å‘Šå’Œ notesï¼Œæå–æŠ€æœ¯å£°æ˜**:

**ç¤ºä¾‹**:
- "CPG çš„ DFG æ˜¯æµä¸æ•æ„Ÿçš„"ï¼ˆTask 2ï¼‰â†’ éªŒè¯ä»»åŠ¡
- "CPG ç¼ºå°‘ Interprocedural DFG"ï¼ˆTask 4 D3ï¼‰â†’ éªŒè¯ä»»åŠ¡
- "CPG ä½¿ç”¨ Handler æ¨¡å¼"ï¼ˆTask 1ï¼‰â†’ éªŒè¯ä»»åŠ¡
- "UnreachableEOGPass å¯ä»¥å‰ªæåˆ†æ”¯"ï¼ˆsem-003ï¼‰â†’ éªŒè¯ä»»åŠ¡

**ä¸ºæ¯ä¸ªå£°æ˜åˆ›å»ºéªŒè¯ä»»åŠ¡**ï¼Œæ·»åŠ åˆ° todolistã€‚

**é¢„è®¡æ•°é‡**: 50-80 ä¸ª

### Task 3: è¯†åˆ«æ¢ç´¢ä»»åŠ¡

**ç´¢å¼• CPG æºç **:
1. Glob åˆ—å‡ºæ‰€æœ‰ Pass: `cpg-core/**/passes/*.kt`
2. Grep æœç´¢æ‰€æœ‰ Handler: `class.*Handler`
3. å¯¹æ¯”æŠ¥å‘Šä¸­å·²åˆ†æ vs å®é™…å­˜åœ¨

**ä¸ºæ¯ä¸ªæœªåˆ†æçš„é¢†åŸŸåˆ›å»ºæ¢ç´¢ä»»åŠ¡**ï¼Œæ·»åŠ åˆ° todolistã€‚

**é¢„è®¡æ•°é‡**: 10-30 ä¸ª

### Task 4: è¯†åˆ«éœ€è¦åç»­è§„åˆ’çš„é¢†åŸŸ

**å…³é”®æ´å¯Ÿ**: æŸäº›é¢†åŸŸå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„è§„åˆ’ã€‚

**ç¤ºä¾‹**:
- å‘ç° CPG æœ‰ 25 ä¸ª Passï¼Œä½†æŠ¥å‘Šåªåˆ†æäº† 5 ä¸ª
- å‰©ä½™ 20 ä¸ª Pass å¯èƒ½éœ€è¦è¿›ä¸€æ­¥è§„åˆ’ï¼ˆæ¯ä¸ª Pass å¯èƒ½äº§ç”Ÿå¤šä¸ªä»»åŠ¡ï¼‰
- åˆ›å»ºåç»­ Planning Task: "æ·±å…¥è§„åˆ’æœªåˆ†æçš„ 20 ä¸ª Pass"

**ä¸ºæ¯ä¸ªéœ€è¦åç»­è§„åˆ’çš„é¢†åŸŸåˆ›å»º Planning Task**ï¼Œæ·»åŠ åˆ° planning_queueã€‚

**é¢„è®¡æ•°é‡**: 0-10 ä¸ªï¼ˆå¯èƒ½ä¸ºç©ºï¼‰

### Task 5: åˆ›å»º todolist å’Œé˜Ÿåˆ—

**è¾“å‡ºæ–‡ä»¶**:

**1. todolist.json** - åŠ¨æ€ä»»åŠ¡æ¸…å•
```json
{
  "generated_at": "<timestamp>",
  "total_tasks": 75,
  "completed": 0,
  "pending": 75,
  "tasks": [
    {
      "id": "task-1",
      "type": "verification",
      "description": "éªŒè¯ D1: Static Final Field DFG Missing",
      "source": "Task 4",
      "priority": "P0",
      "batch": 1,
      "status": "pending"
    },
    ...
  ]
}
```

**2. planning_queue.json** - è§„åˆ’é˜Ÿåˆ—
```json
{
  "queue": [
    {
      "id": "planning-2",
      "description": "æ·±å…¥è§„åˆ’æœªåˆ†æçš„ 15 ä¸ª Pass",
      "reason": "æŠ¥å‘Šä¸­åªåˆ†æäº† 5/20 ä¸ª Pass",
      "status": "pending"
    },
    ...
  ],
  "total": 3
}
```

**3. task-breakdown.md** - äººç±»å¯è¯»çš„ä»»åŠ¡æ¸…å•

---

## Important Notes

1. **ä¸è¦é™åˆ¶è¯»å–é‡**: ä½ å¯ä»¥è¯»å– 10K-20K è¡Œï¼Œè¿™æ˜¯æ­£å¸¸çš„
2. **ä¸è¦é™åˆ¶ä»»åŠ¡æ•°é‡**: todolist å¯èƒ½æœ‰ 50 ä¸ªã€80 ä¸ªã€ç”šè‡³ 120 ä¸ªä»»åŠ¡
3. **åŠ¨æ€å‘ç°**: å¦‚æœä½ å‘ç°æŸä¸ªé¢†åŸŸéœ€è¦æ›´æ·±å…¥è§„åˆ’ï¼Œæ·»åŠ åˆ° planning_queue
4. **ä¼˜å…ˆçº§æ’åº**: P0 ä»»åŠ¡åœ¨å‰ï¼ŒP2 ä»»åŠ¡åœ¨å

---

å¼€å§‹è§„åˆ’å§ï¼
```

---

## 4. Phase 2: åŠ¨æ€æ‰§è¡Œï¼ˆä¸¤ä¸ªé˜Ÿåˆ—äº¤æ›¿ï¼‰

### 4.1 é˜Ÿåˆ—ç®¡ç†ç­–ç•¥

**ä¸¤ä¸ªé˜Ÿåˆ—**:
1. **Planning Queue** (è§„åˆ’é˜Ÿåˆ—)
   - è§„åˆ’ä»»åŠ¡ï¼ˆPlanning Tasksï¼‰
   - **ä¸²è¡Œæ‰§è¡Œ**ï¼ˆé¿å… todolist å¹¶å‘å†™å†²çªï¼‰
   - Planning Subagent å¯ä»¥è¯»å†™ todolist
   - æ•°é‡ï¼šåŠ¨æ€ï¼ˆ0-10 ä¸ªï¼‰

2. **Execution Queue** (æ‰§è¡Œé˜Ÿåˆ—)
   - æ‰§è¡Œä»»åŠ¡ï¼ˆExecution Tasksï¼‰
   - **æ‰¹å¤„ç†å¹¶è¡Œ**ï¼ˆæ¯æ‰¹ 5 ä¸ªï¼‰
   - Execution Subagent **åªè¯»** todolist
   - æ•°é‡ï¼šåŠ¨æ€ï¼ˆ60-120 ä¸ªï¼‰

**ä¸ºä»€ä¹ˆ Planning ä¸²è¡Œï¼ŒExecution å¹¶è¡Œ**ï¼Ÿ
- âœ… **Planning ä¿®æ”¹ todolist** â†’ å¿…é¡»ä¸²è¡Œï¼ˆé¿å…å¹¶å‘å†™ï¼‰
- âœ… **Execution åªè¯» todolist** â†’ å¯ä»¥å¹¶è¡Œï¼ˆæ— å†™å†²çªï¼‰

### 4.2 æ‰§è¡Œå¾ªç¯

**Main Agent çš„é˜Ÿåˆ—ç®¡ç†å¾ªç¯**:

```python
# ä¼ªä»£ç ï¼ˆMain Agent æ‰§è¡Œï¼‰
TODOLIST_PATH = "/home/dai/code/cpg/claude/temp/task-9/todolist.json"
PLANNING_QUEUE_PATH = "/home/dai/code/cpg/claude/temp/task-9/planning_queue.json"

while True:
    # Step 1: å¤„ç† Planning Queueï¼ˆä¸²è¡Œï¼‰
    planning_queue = read_json(PLANNING_QUEUE_PATH)
    if planning_queue.has_pending_tasks():
        planning_task = planning_queue.get_next()

        # å¯åŠ¨ Planning Subagentï¼ˆä¸²è¡Œï¼Œä¸€æ¬¡åªå¯åŠ¨ 1 ä¸ªï¼‰
        launch_planning_subagent(planning_task)

        # Planning Subagent å¯èƒ½:
        # - æ·»åŠ æ–°çš„ Execution Tasks åˆ° TODOLIST_PATH
        # - æ·»åŠ æ–°çš„ Planning Tasks åˆ° PLANNING_QUEUE_PATH

        # æ›´æ–°é˜Ÿåˆ—
        planning_queue = read_json(PLANNING_QUEUE_PATH)  # é‡æ–°è¯»å–ï¼ˆå¯èƒ½å·²æ›´æ–°ï¼‰
        mark_completed(planning_queue, planning_task)
        write_json(PLANNING_QUEUE_PATH, planning_queue)

        # Checkpoint
        update_episodic_note("Planning task completed")

        # ç»§ç»­ä¸‹ä¸€ä¸ª Planning Taskï¼ˆå¦‚æœæœ‰ï¼‰
        continue

    # Step 2: å¤„ç† Execution Queueï¼ˆæ‰¹å¤„ç†å¹¶è¡Œï¼‰
    todolist = read_json(TODOLIST_PATH)
    execution_tasks = todolist.get_next_batch(size=5, status="pending")

    if len(execution_tasks) == 0:
        # ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ä¸ºç©ºï¼Œè¿›å…¥ Phase 3
        break

    # å¯åŠ¨ 5 ä¸ª Execution Subagentsï¼ˆå¹¶è¡Œï¼‰
    launch_parallel_execution_subagents(execution_tasks)

    # ç­‰å¾…å®Œæˆï¼Œæ”¶é›†æŠ¥å‘Š
    # æŠ¥å‘Šè·¯å¾„: /home/dai/code/cpg/claude/temp/task-9/report-task-<id>.md
    reports = collect_reports(execution_tasks)

    # æ›´æ–° todolistï¼ˆåªæ ‡è®°å®Œæˆï¼Œä¸æ·»åŠ æ–°ä»»åŠ¡ï¼‰
    todolist = read_json(TODOLIST_PATH)
    mark_completed(todolist, execution_tasks)
    write_json(TODOLIST_PATH, todolist)

    # Checkpoint
    update_episodic_note("Batch completed", execution_tasks)

    # ç»§ç»­ä¸‹ä¸€æ‰¹
```

### 4.3 åŠ¨æ€å‘ç°å’Œä»»åŠ¡æ·»åŠ 

**åœºæ™¯ç¤ºä¾‹**ï¼š

```
Batch 3 æ‰§è¡Œå®Œæˆåï¼ŒMain Agent æ£€æŸ¥ planning_queue:

planning_queue.json:
{
  "queue": [
    {
      "id": "planning-2",
      "description": "æ·±å…¥è§„åˆ’ Annotation å¤„ç†",
      "reason": "Exploration Task E1 å‘ç° Annotation ç›¸å…³çš„ 5 ä¸ª Passï¼Œéœ€è¦è¯¦ç»†è§„åˆ’",
      "status": "pending"
    }
  ]
}

Main Agent å¯åŠ¨ Planning Subagent 2:
â”œâ”€ Planning Subagent 2 è¯»å– Annotation ç›¸å…³æºç 
â”œâ”€ å‘ç° 3 ä¸ªå…·ä½“é—®é¢˜éœ€è¦éªŒè¯
â”œâ”€ æ·»åŠ  3 ä¸ªæ–°ä»»åŠ¡åˆ° todolist:
â”‚  - task-76: éªŒè¯ @Retention æ”¯æŒ
â”‚  - task-77: éªŒè¯ @Target æ”¯æŒ
â”‚  - task-78: éªŒè¯ Annotation ç»§æ‰¿
â”œâ”€ æ›´æ–° todolist: total_tasks = 78ï¼ˆä» 75 å¢åŠ åˆ° 78ï¼‰
â””â”€ æ ‡è®° planning-2 ä¸º completed

Main Agent ç»§ç»­ Batch 4...
```

**å…³é”®ç‰¹æ€§**:
- âœ… **åŠ¨æ€å‘ç°**: Planning Subagent åœ¨è°ƒç ”åå‘ç°æ–°é—®é¢˜
- âœ… **åŠ¨æ€æ·»åŠ **: ä»»åŠ¡æ•°é‡ä¸å›ºå®šï¼ˆä» 75 å¢åŠ åˆ° 78ï¼‰
- âœ… **è¿™æ˜¯æ­£å¸¸çš„**: æ·±å…¥è°ƒç ”åå‘ç°æ›´å¤šç»†èŠ‚é—®é¢˜

### 4.4 Planning Subagent Prompt Template

```markdown
You are a **Planning Subagent** for Task 9: CPG å…¨é¢å®¡è®¡.

**Your Specific Task**: <ä» planning_queue è¯»å–çš„è§„åˆ’ä»»åŠ¡>

---

## Task Information

**Planning Task ID**: planning-<N>
**Description**: <è§„åˆ’ä»»åŠ¡æè¿°>
**Reason**: <ä¸ºä»€ä¹ˆéœ€è¦æ­¤è§„åˆ’>

---

## Your Mission

ä½ çš„ä»»åŠ¡æ˜¯**æ·±å…¥è§„åˆ’**æŸä¸ªé¢†åŸŸï¼Œæå–æ‰€æœ‰éœ€è¦éªŒè¯/æ¢ç´¢çš„å­ä»»åŠ¡ã€‚

**ä½ å¯ä»¥**:
1. âœ… **ä¸é™åˆ¶åœ°è¯»å–æ–‡ä»¶**ï¼ˆ10K-20K è¡Œéƒ½å¯ä»¥ï¼‰
2. âœ… **æ·»åŠ æ–°ä»»åŠ¡åˆ° todolist**ï¼ˆExecution Tasksï¼‰
3. âœ… **æ·»åŠ æ–°è§„åˆ’åˆ° planning_queue**ï¼ˆå¦‚æœå‘ç°éœ€è¦æ›´æ·±å…¥è§„åˆ’çš„é¢†åŸŸï¼‰

**é‡è¦**: ä½ çš„ä¸»è¦ç›®çš„æ˜¯**å¸è½½ Main Agent çš„ context**ï¼Œæ‰€ä»¥å³ä½¿è¯»å–å¤§é‡æ–‡ä»¶ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚

---

## Your Tasks

### Task 1: æ·±å…¥è°ƒç ”

**æ ¹æ®ä½ çš„è§„åˆ’ä»»åŠ¡ï¼Œæ·±å…¥è°ƒç ”ç›¸å…³é¢†åŸŸ**:
- è¯»å–ç›¸å…³æŠ¥å‘Šï¼ˆä¸é™åˆ¶ï¼‰
- è¯»å–ç›¸å…³ Memory notesï¼ˆä¸é™åˆ¶ï¼‰
- è¯»å–ç›¸å…³ CPG æºç ï¼ˆä¸é™åˆ¶ï¼‰
- ç´¢å¼•ç›¸å…³æ–‡ä»¶ï¼ˆGlob/Grepï¼‰

**Context Budget**: **ä¸é™åˆ¶**ï¼ˆ10K-20K è¡Œï¼‰

### Task 2: æå–å­ä»»åŠ¡

**åŸºäºè°ƒç ”ç»“æœï¼Œæå–æ‰€æœ‰éœ€è¦éªŒè¯/æ¢ç´¢çš„å­ä»»åŠ¡**:

**ç¤ºä¾‹**ï¼ˆåŠ¨æ€å‘ç°ï¼‰:
```
ä½ è¯»å–äº† Annotation ç›¸å…³çš„æºç ï¼Œå‘ç°:
- CPG æœ‰ AnnotationMemberHandler
- CPG æœ‰ AnnotationPass
- CPG æœ‰ @Retention, @Target çš„å»ºæ¨¡

ä½ å‘ç° 3 ä¸ªéœ€è¦éªŒè¯çš„å…·ä½“é—®é¢˜:
1. @Retention çš„æ‰€æœ‰å€¼æ˜¯å¦éƒ½æ”¯æŒï¼Ÿ
2. @Target çš„æ‰€æœ‰ç›®æ ‡æ˜¯å¦éƒ½æ”¯æŒï¼Ÿ
3. Annotation ç»§æ‰¿æ˜¯å¦æ­£ç¡®å¤„ç†ï¼Ÿ

ä½ åˆ›å»º 3 ä¸ªæ–°ä»»åŠ¡æ·»åŠ åˆ° todolist:
- task-76: éªŒè¯ @Retention æ”¯æŒ
- task-77: éªŒè¯ @Target æ”¯æŒ
- task-78: éªŒè¯ Annotation ç»§æ‰¿
```

**è¿™æ˜¯æ­£å¸¸çš„**: ä¸€ä¸ªè§„åˆ’ä»»åŠ¡å¯èƒ½äº§ç”Ÿ 1 ä¸ªã€3 ä¸ªã€ç”šè‡³ 10 ä¸ªå­ä»»åŠ¡ã€‚

### Task 3: æ·»åŠ ä»»åŠ¡åˆ° todolist

**è¯»å–å½“å‰ todolist**:
```json
{
  "total_tasks": 75,
  "tasks": [...]
}
```

**æ·»åŠ æ–°ä»»åŠ¡**:
```json
{
  "total_tasks": 78,  // ä» 75 å¢åŠ åˆ° 78
  "tasks": [
    ... (åŸæœ‰ 75 ä¸ª),
    {
      "id": "task-76",
      "type": "verification",
      "description": "éªŒè¯ @Retention æ”¯æŒ",
      "source": "Planning-2 å‘ç°",
      "priority": "P1",
      "batch": 16,  // åŠ¨æ€åˆ†é…æ‰¹æ¬¡
      "status": "pending"
    },
    {
      "id": "task-77",
      ...
    },
    {
      "id": "task-78",
      ...
    }
  ]
}
```

### Task 4: ï¼ˆå¯é€‰ï¼‰æ·»åŠ åç»­è§„åˆ’åˆ° planning_queue

å¦‚æœä½ å‘ç°æŸä¸ªé¢†åŸŸä»éœ€è¦æ›´æ·±å…¥è§„åˆ’ï¼Œæ·»åŠ åˆ° planning_queue:

```json
{
  "queue": [
    ... (åŸæœ‰),
    {
      "id": "planning-3",
      "description": "æ·±å…¥è§„åˆ’ Generic Type å»ºæ¨¡",
      "reason": "å‘ç° Generic ç›¸å…³çš„ 10 ä¸ªç±»ï¼Œéœ€è¦è¯¦ç»†åˆ†æ",
      "status": "pending"
    }
  ]
}
```

---

## Output

**æ˜ç¡®ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶è·¯å¾„**:

1. **æ›´æ–° Todolist**: `/home/dai/code/cpg/claude/temp/task-9/todolist.json`ï¼ˆæ·»åŠ æ–°ä»»åŠ¡ï¼‰
2. **æ›´æ–° Planning Queue**: `/home/dai/code/cpg/claude/temp/task-9/planning_queue.json`ï¼ˆå¯é€‰ï¼Œå¦‚æœéœ€è¦åç»­è§„åˆ’ï¼‰
3. **äº§å‡º Planning Report**: `/home/dai/code/cpg/claude/temp/task-9/planning-<N>-report.md`ï¼ˆè§„åˆ’æŠ¥å‘Šï¼Œè®°å½•ä½ çš„å‘ç°ï¼‰

---

## Important Notes

1. **ä¸è¦é™åˆ¶è¯»å–é‡**: è¿™æ˜¯ä½ çš„ä¼˜åŠ¿ï¼Œå……åˆ†åˆ©ç”¨
2. **åŠ¨æ€å‘ç°**: æ·±å…¥è°ƒç ”åå‘ç°æ–°é—®é¢˜æ˜¯æ­£å¸¸çš„
3. **çµæ´»æ·»åŠ **: å¯ä»¥æ·»åŠ  1 ä¸ªã€3 ä¸ªã€ç”šè‡³ 10 ä¸ªæ–°ä»»åŠ¡
4. **ä¸²è¡Œæ‰§è¡Œ**: ä½ æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œä¸ç”¨æ‹…å¿ƒå¹¶å‘é—®é¢˜

---

å¼€å§‹è§„åˆ’å§ï¼
```

---

## 5. Phase 2: åŠ¨æ€æ‰§è¡Œï¼ˆé˜Ÿåˆ—äº¤æ›¿ï¼‰

### 5.1 Main Agent çš„é˜Ÿåˆ—ç®¡ç†å¾ªç¯

**æ‰§è¡Œæµç¨‹**ï¼ˆMain Agentï¼‰:

```markdown
## å¾ªç¯å¼€å§‹

### Step 1: æ£€æŸ¥ Planning Queue

è¯»å– planning_queue.json:
- å¦‚æœæœ‰ pending Planning Tasks:
  - å–å‡ºä¸‹ä¸€ä¸ª Planning Task
  - å¯åŠ¨ Planning Subagentï¼ˆ**ä¸²è¡Œï¼Œä¸€æ¬¡åªå¯åŠ¨ 1 ä¸ª**ï¼‰
  - ç­‰å¾… Planning Subagent å®Œæˆ
  - Planning Subagent å¯èƒ½:
    - æ·»åŠ æ–°çš„ Execution Tasks åˆ° todolist
    - æ·»åŠ æ–°çš„ Planning Tasks åˆ° planning_queue
  - æ›´æ–° planning_queue: æ ‡è®°å½“å‰ Planning Task ä¸º completed
  - Checkpointï¼ˆè®°å½•è§„åˆ’è¿›åº¦ï¼‰
  - **å›åˆ° Step 1**ï¼ˆç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ª Planning Taskï¼‰

### Step 2: æ£€æŸ¥ Execution Queue

è¯»å– todolist.json:
- è·å–ä¸‹ä¸€æ‰¹ 5 ä¸ª Execution Tasksï¼ˆstatus="pending"ï¼‰
- å¦‚æœæœ‰ pending Execution Tasks:
  - å¯åŠ¨ 5 ä¸ª Execution Subagentsï¼ˆ**å¹¶è¡Œ**ï¼‰
  - ç­‰å¾… 5 ä¸ª subagents å®Œæˆ
  - æ”¶é›† 5 ä¸ªå°æŠ¥å‘Š
  - æ›´æ–° todolist: æ ‡è®° 5 ä¸ªä»»åŠ¡ä¸º completed
  - Checkpointï¼ˆè®°å½•æ‰§è¡Œè¿›åº¦ï¼‰
  - **å›åˆ° Step 1**ï¼ˆä¼˜å…ˆå¤„ç† Planning Queueï¼‰

### Step 3: æ£€æŸ¥æ˜¯å¦å®Œæˆ

- å¦‚æœ planning_queue ä¸ºç©º AND todolist æ‰€æœ‰ä»»åŠ¡éƒ½ completed:
  - è¿›å…¥ Phase 3
- å¦åˆ™:
  - å›åˆ° Step 1

## å¾ªç¯ç»“æŸ
```

**å…³é”®è®¾è®¡**:
- âœ… **Planning ä¼˜å…ˆ**: æ¯æ¬¡å¾ªç¯å…ˆæ£€æŸ¥ planning_queue
- âœ… **ä¸²è¡Œ Planning**: Planning Subagent ä¸€æ¬¡åªæ‰§è¡Œ 1 ä¸ª
- âœ… **å¹¶è¡Œ Execution**: Execution Subagents æ¯æ‰¹ 5 ä¸ªå¹¶è¡Œ
- âœ… **åŠ¨æ€é€‚åº”**: todolist å’Œ planning_queue éšæ—¶å¯èƒ½æ›´æ–°

### 5.2 Execution Subagent Prompt Template

```markdown
You are an **Execution Subagent** for Task 9: CPG å…¨é¢å®¡è®¡.

**Your Specific Task**: <ä» todolist è¯»å–çš„ä»»åŠ¡æè¿°>

---

## Task Information

**Task ID**: task-<N>
**Task Type**: [verification / exploration]
**Source**: <æ¥è‡ªå“ªä¸ªæŠ¥å‘Š/Planning>
**Priority**: <P0/P1/P2>

### For Verification Task:
**Claim**: <éœ€è¦éªŒè¯çš„å£°æ˜>

### For Exploration Task:
**Area**: <éœ€è¦æ¢ç´¢çš„é¢†åŸŸ>

---

## Your Mission

### For Verification Task:
1. å®šä½ç›¸å…³æºç æ–‡ä»¶ï¼ˆä½¿ç”¨ Grep/Globï¼‰
2. é˜…è¯»æ ¸å¿ƒå®ç°ï¼ˆ<1500 è¡Œï¼‰
3. è¯„ä¼°å®ç°ç¨‹åº¦ï¼ˆ0-100%ï¼‰
4. æä¾›ä»£ç è¯æ®
5. åˆ¤æ–­å£°æ˜æ˜¯å¦æ­£ç¡®

### For Exploration Task:
1. ç´¢å¼•é˜¶æ®µ: Glob/Grep å®šä½ç›¸å…³æ–‡ä»¶
2. åˆ†æé˜¶æ®µ: é˜…è¯»æ ¸å¿ƒå®ç°ï¼ˆ<1500 è¡Œï¼‰
3. è¯„ä¼°åŠŸèƒ½å®Œæ•´æ€§
4. è¯†åˆ«æ½œåœ¨ç¼ºé™·

---

## Output

**æ˜ç¡®ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶è·¯å¾„**:

äº§å‡ºæŠ¥å‘Š: `/home/dai/code/cpg/claude/temp/task-9/report-task-<task-id>.md`

**é‡è¦**: ä½¿ç”¨ `task-id`ï¼ˆä» todolistï¼‰ï¼Œä¾‹å¦‚ï¼š
- task-id = "task-1" â†’ æ–‡ä»¶å = `report-task-1.md`
- task-id = "task-76" â†’ æ–‡ä»¶å = `report-task-76.md`

**Format** (Verification):
```markdown
---
task_id: task-<N>
type: verification
source: <æ¥æº>
claim: <å£°æ˜>
status: [å®Œå…¨æ­£ç¡® / éƒ¨åˆ†æ­£ç¡® / å®Œå…¨é”™è¯¯]
implementation: <0-100%>
---

### 1. åŸå§‹å£°æ˜
<å¤è¿°>

### 2. æºç å®¡è®¡
**ä»£ç è¯æ®**: <æ–‡ä»¶:è¡Œå· + ä»£ç >
**å®ç°ç¨‹åº¦**: <åˆ†æ>

### 3. éªŒè¯ç»“è®º
<æ˜¯å¦æ­£ç¡®ï¼Ÿå®é™…æƒ…å†µï¼Ÿ>

### 4. å½±å“åˆ†æ
<åå·®çš„å½±å“ï¼Ÿ>
```

**Format** (Exploration):
```markdown
---
task_id: task-<N>
type: exploration
area: <é¢†åŸŸ>
status: [å·²å®ç° / éƒ¨åˆ†å®ç° / æœªå®ç°]
new_findings: <æ•°é‡>
---

### 1. æ¢ç´¢ç›®æ ‡
<ä¸ºä»€ä¹ˆæ¢ç´¢ï¼Ÿ>

### 2. ç´¢å¼•ç»“æœ
<æ–‡ä»¶å’Œç±»>

### 3. åŠŸèƒ½åˆ†æ
<ä»£ç è¯æ® + å®ç°ç¨‹åº¦>

### 4. å‘ç°
<æ–°åŠŸèƒ½æˆ–ç¼ºé™·>
```

---

## Context Budget

- ä»»åŠ¡æè¿°: ~300 è¡Œ
- æºç é˜…è¯»: <1500 è¡Œ
- æŠ¥å‘Šäº§å‡º: ~400 è¡Œ
- **æ€»è®¡**: <2500 è¡Œ

---

## Important Notes

1. ä½ **åªè¯»** todolistï¼ˆä¸ä¿®æ”¹ï¼‰
2. æä¾›ä»£ç è¯æ®ï¼ˆæ–‡ä»¶:è¡Œå·ï¼‰
3. æŠ¥å‘Šé•¿åº¦: 200-500 è¡Œ

---

å¼€å§‹æ‰§è¡Œå§ï¼
```

---

## 6. è¿›åº¦è·Ÿè¸ªä¸å¯ä¸­æ–­æ€§

### 6.1 Todolist è¿›åº¦è·Ÿè¸ª

**todolist.json** å®æ—¶æ›´æ–°:
```json
{
  "total_tasks": 78,  // å¯èƒ½åŠ¨æ€å¢åŠ ï¼ˆPlanning Subagent æ·»åŠ ï¼‰
  "completed": 15,
  "pending": 63,
  "progress": "19%",
  "last_updated": "2025-11-13 18:30:00"
}
```

### 6.2 Planning Queue è¿›åº¦è·Ÿè¸ª

**planning_queue.json** å®æ—¶æ›´æ–°:
```json
{
  "queue": [
    {
      "id": "planning-2",
      "description": "æ·±å…¥è§„åˆ’æœªåˆ†æçš„ 15 ä¸ª Pass",
      "status": "completed"
    },
    {
      "id": "planning-3",
      "description": "æ·±å…¥è§„åˆ’ Generic Type å»ºæ¨¡",
      "status": "pending"
    }
  ],
  "total": 3,
  "completed": 1,
  "pending": 2
}
```

### 6.3 Episodic Note è¿›åº¦è·Ÿè¸ª

**episodic note** å®æ—¶æ›´æ–°:
```markdown
## Progress (Updated: 2025-11-13 Day 2, 18:30)

### Planning Queue
- planning-1 (âœ…): åˆå§‹è§„åˆ’å®Œæˆï¼ˆäº§å‡º 75 ä¸ªä»»åŠ¡ï¼‰
- planning-2 (âœ…): æ·±å…¥è§„åˆ’ 15 ä¸ª Passï¼ˆæ·»åŠ  3 ä¸ªæ–°ä»»åŠ¡ï¼‰
- planning-3 (â³): å¾…æ‰§è¡Œ

### Execution Queue
- Batch 1 (âœ…): task-1 to task-5 å®Œæˆï¼ˆ5/78, 6%ï¼‰
- Batch 2 (âœ…): task-6 to task-10 å®Œæˆï¼ˆ10/78, 13%ï¼‰
- Batch 3 (âœ…): task-11 to task-15 å®Œæˆï¼ˆ15/78, 19%ï¼‰
- Batch 4 (â³): å¾…æ‰§è¡Œ

**æ€»è¿›åº¦**: 15/78 Execution Tasks + 2/3 Planning Tasks
```

### 6.4 å¯ä¸­æ–­å’Œæ¢å¤

**åœºæ™¯**:
```
Day 1 (18:00):
- å®Œæˆ planning-1ï¼ˆåˆå§‹è§„åˆ’ï¼Œ75 ä¸ªä»»åŠ¡ï¼‰
- å®Œæˆ Batch 1-3ï¼ˆ15 ä¸ªä»»åŠ¡ï¼‰
- é‡åˆ°è´¦æˆ·é™åˆ¶æˆ–ç”¨æˆ·éœ€è¦æš‚åœ
- æ›´æ–° todolist å’Œ planning_queue
- æ›´æ–° episodic note

Day 2 (09:00):
- ç»§ç»­æ‰§è¡Œ
- æ£€æŸ¥ planning_queue: planning-2 pending
  - æ‰§è¡Œ planning-2ï¼ˆæ·»åŠ  3 ä¸ªæ–°ä»»åŠ¡ï¼‰
- æ£€æŸ¥ todolist: 63 ä¸ª pending
  - æ‰§è¡Œ Batch 4ï¼ˆtask-16 to task-20ï¼‰
  - æ‰§è¡Œ Batch 5ï¼ˆtask-21 to task-25ï¼‰
- ...
```

**ä»·å€¼**:
- âœ… å®Œå…¨å¯ä¸­æ–­ï¼ˆæ¯æ‰¹ä¹‹é—´ã€æ¯ä¸ª Planning Task ä¹‹é—´ï¼‰
- âœ… è¿›åº¦ä¸ä¸¢å¤±ï¼ˆtodolist + planning_queue + episodic noteï¼‰
- âœ… å¯åˆ†å¤šå¤©æ‰§è¡Œï¼ˆæ¯å¤© 2-3 æ‰¹ï¼‰

---

## 7. æ‰§è¡Œç¤ºä¾‹ (Execution Example)

### 7.1 å®Œæ•´æ‰§è¡Œæµç¨‹ç¤ºä¾‹

**Day 1 - Phase 1 (åˆå§‹è§„åˆ’)**:
```
09:00 - å¯åŠ¨ Initial Planning Subagent
      - è¯»å–æ‰€æœ‰æŠ¥å‘Š + Memoryï¼ˆ15K è¡Œï¼‰
      - æå– 75 ä¸ªä»»åŠ¡
      - è¯†åˆ« 3 ä¸ªåç»­è§„åˆ’ä»»åŠ¡
      - äº§å‡º: todolist.json (75 tasks) + planning_queue.json (3 planning tasks)
12:00 - Phase 1 å®Œæˆ
```

**Day 1 - Phase 2 å¼€å§‹**:
```
13:00 - æ£€æŸ¥ planning_queue: 3 ä¸ª pending
      - æ‰§è¡Œ planning-2: "æ·±å…¥è§„åˆ’æœªåˆ†æçš„ 15 ä¸ª Pass"
        - Planning Subagent è¯»å– 15 ä¸ª Pass çš„æºç ï¼ˆ8K è¡Œï¼‰
        - å‘ç° 3 ä¸ªéœ€è¦éªŒè¯çš„é—®é¢˜
        - æ·»åŠ  task-76, task-77, task-78 åˆ° todolist
        - todolist.total_tasks: 75 â†’ 78

14:00 - æ£€æŸ¥ todolist: 78 ä¸ª pending
      - æ‰§è¡Œ Batch 1: task-1 to task-5ï¼ˆå¹¶è¡Œï¼‰
        - 5 ä¸ª Execution Subagents å®Œæˆ
        - æ”¶é›† 5 ä¸ªæŠ¥å‘Š
        - æ›´æ–° todolist: 5 completed, 73 pending

15:00 - æ‰§è¡Œ Batch 2: task-6 to task-10
16:00 - æ‰§è¡Œ Batch 3: task-11 to task-15
17:00 - é‡åˆ°è´¦æˆ·é™åˆ¶ï¼Œæš‚åœ
      - è¿›åº¦: 15/78 Execution (19%), 1/3 Planning (33%)
```

**Day 2 - Phase 2 ç»§ç»­**:
```
09:00 - ç»§ç»­æ‰§è¡Œ
      - æ£€æŸ¥ planning_queue: 2 ä¸ª pending
      - æ‰§è¡Œ planning-3: "æ·±å…¥è§„åˆ’ Generic Type å»ºæ¨¡"
        - Planning Subagent å‘ç° 2 ä¸ªæ–°ä»»åŠ¡
        - æ·»åŠ  task-79, task-80 åˆ° todolist
        - todolist.total_tasks: 78 â†’ 80

10:00 - æ‰§è¡Œ Batch 4: task-16 to task-20
11:00 - æ‰§è¡Œ Batch 5: task-21 to task-25
...
```

**Day 10 - Phase 2 å®Œæˆ**:
```
- æ‰€æœ‰ Planning Tasks å®Œæˆï¼ˆ3/3ï¼‰
- æ‰€æœ‰ Execution Tasks å®Œæˆï¼ˆ80/80ï¼‰
- è¿›å…¥ Phase 3
```

---

## 8. å…³é”®è®¾è®¡åŸåˆ™

### åŸåˆ™ 1: Planning Subagent ä¸é™åˆ¶è¯»å–é‡

**ç”¨æˆ·çš„æ´å¯Ÿ**:
> "è§„åˆ’çš„subagentï¼Œä»–çš„ç›®çš„æ˜¯è§„åˆ’å¯èƒ½è¦é˜…è¯»å¤§é‡æ–‡ä»¶ï¼Œå•çº¯å¸è½½contextï¼Œè§„åˆ’çš„subagentä¸è¦é™åˆ¶ä»–èƒ½è¯»ä»€ä¹ˆ"

**å®ç°**:
- âœ… Planning Subagent å¯ä»¥è¯»å– 10K-20K è¡Œï¼ˆä¸é™åˆ¶ï¼‰
- âœ… ä¸»è¦ç›®çš„ï¼š**å¸è½½ Main Agent çš„ context**
- âœ… Planning Subagent æ‰¿æ‹…"å¤§é‡é˜…è¯»"çš„å·¥ä½œ

**ä¸ºä»€ä¹ˆ**:
- Main Agent éœ€è¦ç®¡ç†æ•´ä¸ªæ‰§è¡Œå¾ªç¯ â†’ context ç´§å¼ 
- Planning Subagent åªä¸“æ³¨äºè§„åˆ’ â†’ å¯ä»¥è¯»å–å¤§é‡æ–‡ä»¶
- **Context åˆ†æ‹…**: Main Agent (è½»é‡) + Planning Subagent (é‡é‡)

### åŸåˆ™ 2: Planning Subagent ä¸²è¡Œæ‰§è¡Œï¼ˆé˜Ÿåˆ—ï¼‰

**ç”¨æˆ·çš„æ´å¯Ÿ**:
> "è§„åˆ’ä¼šå¯¹todoliståšè¯»å†™ï¼Œä¸ºäº†é¿å…å¹¶å‘é—®é¢˜ï¼Œè§„åˆ’çš„subagentä¸å¹¶è¡Œæ‰§è¡Œï¼Œè€Œæ˜¯é‡‡ç”¨é˜Ÿåˆ—çš„å½¢å¼"

**å®ç°**:
- âœ… Planning Subagents **ä¸²è¡Œæ‰§è¡Œ**ï¼ˆä¸€æ¬¡åªå¯åŠ¨ 1 ä¸ªï¼‰
- âœ… é¿å… todolist çš„å¹¶å‘å†™å†²çª
- âœ… é˜Ÿåˆ—å½¢å¼ï¼šplanning_queue.json

**ä¸ºä»€ä¹ˆ**:
- Planning Subagent ä¼š**ä¿®æ”¹ todolist**ï¼ˆæ·»åŠ æ–°ä»»åŠ¡ï¼‰
- å¦‚æœå¹¶è¡Œæ‰§è¡Œ â†’ ä¸¤ä¸ª Planning Subagents åŒæ—¶ä¿®æ”¹ todolist â†’ å†²çª
- **ä¸²è¡Œæ‰§è¡Œ** â†’ ä¸€æ¬¡åªæœ‰ 1 ä¸ª Planning Subagent ä¿®æ”¹ todolist â†’ æ— å†²çª

### åŸåˆ™ 3: åŠ¨æ€å‘ç°æ˜¯æ­£å¸¸çš„

**ç”¨æˆ·çš„æ´å¯Ÿ**:
> "ä¸€ä¸ªè§„åˆ’çš„subagentçœ‹è§è®°å¿†ä¸­çš„æŸä¸ªç‰‡æ®µï¼Œè°ƒç ”åˆ°sourceåå‘ç°å®é™…ä¸Šäº§ç”Ÿäº†ä¸‰ä¸ªé—®é¢˜ï¼Œè¿™æ˜¯å¾ˆæ­£å¸¸çš„"

**å®ç°**:
- âœ… Planning Subagent å¯ä»¥**åŠ¨æ€æ·»åŠ **ä»»åŠ¡
- âœ… 1 ä¸ªè§„åˆ’ä»»åŠ¡ â†’ å¯èƒ½äº§ç”Ÿ 3 ä¸ªã€5 ä¸ªã€ç”šè‡³ 10 ä¸ªå­ä»»åŠ¡
- âœ… todolist.total_tasks å¯èƒ½ä» 75 å¢åŠ åˆ° 80ã€85ã€90...
- âœ… **è¿™æ˜¯æ­£å¸¸çš„**ï¼ˆæ·±å…¥è°ƒç ”åå‘ç°æ›´å¤šç»†èŠ‚ï¼‰

**ä¸ºä»€ä¹ˆ**:
- åˆå§‹è§„åˆ’å¯èƒ½åŸºäºé«˜å±‚åˆ†æï¼ˆä¸å¤Ÿç»†è‡´ï¼‰
- æ·±å…¥è§„åˆ’åå‘ç°æ›´å¤šç»†èŠ‚é—®é¢˜
- **åŠ¨æ€é€‚åº”** > é™æ€é¢„å®šä¹‰

### åŸåˆ™ 4: ä¸¤ç±» Subagent çš„èŒè´£åˆ†ç¦»

**ç”¨æˆ·çš„æ´å¯Ÿ**:
> "subagentå®é™…ä¸Šåˆ†ä¸ºä¸¤ç±»ï¼Œå¤§ä½“ä¸Šä¸€ç±»æ˜¯åšä»»åŠ¡è§„åˆ’ï¼Œä¸€ç±»æ˜¯åšä»»åŠ¡æ‰§è¡Œ"

**å®ç°**:
- âœ… **Planning Subagent** (è§„åˆ’å‹):
  - è¯»å–å¤§é‡æ–‡ä»¶ï¼ˆä¸é™åˆ¶ï¼‰
  - æå–å­ä»»åŠ¡
  - ä¿®æ”¹ todolistï¼ˆæ·»åŠ æ–°ä»»åŠ¡ï¼‰
  - ä¸²è¡Œæ‰§è¡Œ
- âœ… **Execution Subagent** (æ‰§è¡Œå‹):
  - è¯»å–å°‘é‡æ–‡ä»¶ï¼ˆ<1500 è¡Œï¼‰
  - æ‰§è¡Œå•ä¸ªä»»åŠ¡
  - åªè¯» todolistï¼ˆä¸ä¿®æ”¹ï¼‰
  - æ‰¹å¤„ç†å¹¶è¡Œæ‰§è¡Œ

---

## 9. Memory-First Principle

### 9.1 Planning Subagent çš„ Memory ä½¿ç”¨

**å¿…è¯»**ï¼ˆä¸é™åˆ¶ï¼‰:
1. `/claude/memory/index/tags.json` å’Œ `topics.json`
2. æ‰€æœ‰ semantic notesï¼ˆsem-001 to sem-005ï¼‰
3. æ‰€æœ‰ episodic notesï¼ˆep-001 to ep-020ï¼‰
4. æ‰€æœ‰ procedural notesï¼ˆproc-001 to proc-005ï¼‰

**å¯é€‰**ï¼ˆæ ¹æ®éœ€è¦ï¼‰:
- å†å²æŠ¥å‘Šï¼ˆ`/claude/result/1-8/`ï¼‰
- CPG æºç ï¼ˆç´¢å¼•ï¼‰

**Context**: **ä¸é™åˆ¶**ï¼ˆ10K-20K è¡Œï¼‰

### 9.2 Phase 2 çš„ Memory æ›´æ–°

**æ¯ä¸ªæ‰¹æ¬¡å®Œæˆå**:
- âœ… æ›´æ–° episodic note è®°å½•è¿›åº¦
- âœ… è®°å½• Planning Queue çŠ¶æ€
- âœ… è®°å½• Execution Queue è¿›åº¦

**å¦‚æœå‘ç°é‡è¦ CPG æœºåˆ¶**:
- âœ… åˆ›å»º semantic note
  - ä¾‹å¦‚: `sem-006`: CPG è°ƒç”¨å›¾æœºåˆ¶
  - ä¾‹å¦‚: `sem-007`: CPG è¿‡ç¨‹é—´ DFG æœºåˆ¶

---

## 10. æˆåŠŸæ ‡å‡† (Success Criteria)

### 10.1 Planning è´¨é‡

- âœ… åˆå§‹ todolist è¦†ç›–æ‰€æœ‰æŠ¥å‘Šå’Œ Memory çš„æŠ€æœ¯å£°æ˜
- âœ… è¯†åˆ«äº†æ‰€æœ‰æœªæåˆ°çš„é¢†åŸŸ
- âœ… Planning Queue åˆç†ï¼ˆåç»­è§„åˆ’ä»»åŠ¡æ˜ç¡®ï¼‰
- âœ… ä»»åŠ¡ä¸é™æ•°é‡ï¼ˆ60-120 ä¸ªéƒ½å¯ä»¥ï¼‰

### 10.2 Dynamic è´¨é‡

- âœ… Planning Subagent èƒ½å¤ŸåŠ¨æ€å‘ç°æ–°é—®é¢˜
- âœ… åŠ¨æ€æ·»åŠ ä»»åŠ¡åˆ° todolistï¼ˆä» 75 â†’ 80 â†’ 85...ï¼‰
- âœ… Planning Queue ä¸²è¡Œæ‰§è¡Œï¼ˆæ— å¹¶å‘å†²çªï¼‰

### 10.3 Execution è´¨é‡

- âœ… æ¯ä¸ªå°æŠ¥å‘Šæœ‰ä»£ç è¯æ®
- âœ… å®ç°ç¨‹åº¦è¯„ä¼°æ¸…æ™°
- âœ… æ‰¹å¤„ç†æ‰§è¡Œé¡ºåˆ©ï¼ˆæ¯æ‰¹ 5 ä¸ªï¼‰

### 10.4 Process è´¨é‡

- âœ… å¯ä¸­æ–­å’Œæ¢å¤ï¼ˆtodolist + planning_queue è®°å½•çŠ¶æ€ï¼‰
- âœ… é¿å…è´¦æˆ·é™åˆ¶ï¼ˆæ‰¹å¤„ç† + é˜Ÿåˆ—ï¼‰
- âœ… è¿›åº¦å¯è¿½è¸ªï¼ˆtodolist + episodic noteï¼‰

---

## 11. é£é™©ä¸ç¼“è§£ (Risks and Mitigation)

### é£é™© 1: Planning Subagent è¯»å–è¿‡å¤šå¯¼è‡´è¶…æ—¶

**é£é™©æè¿°**: Planning Subagent è¯»å– 20K è¡Œï¼Œå¯èƒ½è¶…æ—¶
**ç¼“è§£ç­–ç•¥**:
- Planning Subagent å¯ä»¥åˆ†é˜¶æ®µæ‰§è¡Œï¼ˆå…ˆè¯» Memoryï¼Œå†è¯»æŠ¥å‘Šï¼Œå†ç´¢å¼•æºç ï¼‰
- å¦‚æœç¡®å®éœ€è¦è¯»å– >20K è¡Œï¼Œæ‹†åˆ†ä¸ºå¤šä¸ª Planning Tasks

### é£é™© 2: Todolist åŠ¨æ€å¢é•¿è¿‡å¤š

**é£é™©æè¿°**: Planning Subagent ä¸æ–­æ·»åŠ ä»»åŠ¡ï¼Œtodolist ä» 75 å¢é•¿åˆ° 150
**ç¼“è§£ç­–ç•¥**:
- è¿™æ˜¯æ­£å¸¸çš„ï¼ˆæ·±å…¥è°ƒç ”åå‘ç°æ›´å¤šé—®é¢˜ï¼‰
- å¦‚æœä»»åŠ¡æ•° > 120ï¼Œè€ƒè™‘æé«˜ä¼˜å…ˆçº§é˜ˆå€¼ï¼ˆåªæ‰§è¡Œ P0-P1ï¼‰

### é£é™© 3: Planning Queue å’Œ Execution Queue çš„åè°ƒ

**é£é™©æè¿°**: Planning Queue å¯èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸æ–­æ·»åŠ æ–° Planning Tasks
**ç¼“è§£ç­–ç•¥**:
- Main Agent ä¼˜å…ˆå¤„ç† Planning Queueï¼ˆPlanning ä¼˜å…ˆäº Executionï¼‰
- ç¡®ä¿ Planning Tasks åŠæ—¶æ‰§è¡Œï¼Œé¿å… Execution åŸºäºè¿‡æ—¶çš„ todolist

### é£é™© 4: è´¦æˆ·é™åˆ¶

**é£é™©æè¿°**: è¿ç»­æ‰§è¡Œå¯èƒ½è§¦å‘è´¦æˆ·é™åˆ¶
**ç¼“è§£ç­–ç•¥**:
- âœ… æ‰¹å¤„ç†æ‰§è¡Œï¼ˆæ¯æ‰¹ 5 ä¸ªï¼‰
- âœ… Planning ä¸²è¡Œï¼ˆé¿å…è¿ç»­å¯åŠ¨ï¼‰
- âœ… æ¯æ‰¹ä¹‹é—´å¯æš‚åœ
- âœ… todolist + planning_queue è®°å½•çŠ¶æ€ï¼Œå¯æ¢å¤

---

## 12. å¿«é€Ÿå‚è€ƒ (Quick Reference)

### æ‰§è¡Œ Task 9 çš„æ­¥éª¤ï¼ˆMain Agentï¼‰

**Phase 1: åˆå§‹è§„åˆ’** (åŠå¤©)
```
1. å¯åŠ¨ Initial Planning Subagent
2. äº§å‡º:
   - /home/dai/code/cpg/claude/temp/task-9/todolist.json
   - /home/dai/code/cpg/claude/temp/task-9/planning_queue.json
   - /home/dai/code/cpg/claude/temp/task-9/task-breakdown.md
```

**Phase 2: åŠ¨æ€æ‰§è¡Œ** (1-2 å‘¨ï¼Œå¯ä¸­æ–­)
```
å¾ªç¯:
  1. è¯»å– /home/dai/code/cpg/claude/temp/task-9/planning_queue.json
     - å¦‚æœæœ‰ pending: æ‰§è¡Œä¸‹ä¸€ä¸ª Planning Subagentï¼ˆä¸²è¡Œï¼‰
  2. è¯»å– /home/dai/code/cpg/claude/temp/task-9/todolist.json
     - å¦‚æœæœ‰ pending: æ‰§è¡Œä¸‹ä¸€æ‰¹ 5 ä¸ª Execution Subagentsï¼ˆå¹¶è¡Œï¼‰
  3. æ›´æ–° todolist å’Œ planning_queue
  4. æ›´æ–° episodic note (checkpoint)
  5. ç»§ç»­å¾ªç¯
ç›´åˆ°: ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ä¸ºç©º
```

**Phase 3: æœ€ç»ˆæ±‡æ€»** (1-2 å¤©)
```
1. å¯åŠ¨ Synthesis Subagent
2. Synthesis è¯»å–: /home/dai/code/cpg/claude/temp/task-9/report-*.md
3. äº§å‡ºåˆ° /home/dai/code/cpg/claude/result/9/:
   - CPGåŠŸèƒ½å®¡è®¡æŠ¥å‘Š.md
   - åœºæ™¯éªŒè¯æŠ¥å‘Š.md
   - çœŸå®Gapåˆ†æ.md
   - ä¿®æ­£çš„ç ”ç©¶è¯¾é¢˜æ¸…å•.md
```

---

## 13. ä¸å…¶ä»–ä»»åŠ¡çš„å…³ç³»

**è¾“å…¥ä¾èµ–**:
- **Task 1-8**: æ‰€æœ‰å†å²æŠ¥å‘Šï¼ˆéªŒè¯å¯¹è±¡ï¼‰
- **Memory System**: æ‰€æœ‰è®°å½•ï¼ˆéªŒè¯å¯¹è±¡ï¼‰
- **CPG æºç **: çœŸç›¸æ¥æº

**è¾“å‡ºç”¨é€”**:
- **Task 10** (Defect Remediation): åŸºäºçœŸå® Gap å¼€å§‹ä¿®å¤
- **Task 4 Revision**: ä¿®æ­£é”™è¯¯çš„ç¼ºé™·åˆ†æ
- **Memory System Update**: ä¿®æ­£é”™è¯¯çš„ semantic notes

---

**ç‰ˆæœ¬**: 6.0.0 (åŠ¨æ€é˜Ÿåˆ—æ¶æ„)
**æœ€åæ›´æ–°**: 2025-11-13
**çŠ¶æ€**: âœ… Ready for Execution

---

## 14. å…³é”®åˆ›æ–°æ€»ç»“

1. âœ… **åŠ¨æ€ Todolist**: ç”± Planning Subagent åˆ›å»ºå’ŒåŠ¨æ€æ›´æ–°
2. âœ… **ä¸¤ä¸ªé˜Ÿåˆ—**: Planning Queue (ä¸²è¡Œ) + Execution Queue (æ‰¹å¤„ç†å¹¶è¡Œ)
3. âœ… **Planning ä¸é™è¯»å–**: å¯ä»¥è¯»å– 10K-20K è¡Œï¼Œå¸è½½ Main Agent context
4. âœ… **ä¸²è¡Œ Planning**: é¿å… todolist å¹¶å‘å†™å†²çª
5. âœ… **åŠ¨æ€å‘ç°**: 1 ä¸ªè§„åˆ’ä»»åŠ¡å¯èƒ½äº§ç”Ÿ 3 ä¸ªå­ä»»åŠ¡ï¼ˆæ­£å¸¸ï¼‰
6. âœ… **æ‰¹å¤„ç† Execution**: æ¯æ‰¹ 5 ä¸ªï¼Œé¿å…è´¦æˆ·é™åˆ¶
7. âœ… **å¯ä¸­æ–­æ¢å¤**: todolist + planning_queue è®°å½•çŠ¶æ€
8. âœ… **å…¨é¢å®¡è®¡**: æ‰€æœ‰æŠ¥å‘Š + æ‰€æœ‰ Memory + æ‰€æœ‰æœªæåˆ°çš„é¢†åŸŸ
