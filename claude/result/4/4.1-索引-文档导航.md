# CPG æ¶æ„ç¼ºé™·å…¨é¢åˆ†æ (Gap Analysis)

**ä»»åŠ¡**: Task 4 - é¢å‘ Java å¸¸é‡é©±åŠ¨å¯è¾¾æ€§åˆ†æçš„ CPG ç¼ºé™·åˆ†æ
**æ—¥æœŸ**: 2025-10-28
**èŒƒå›´**: çº¯ç¼ºé™·åˆ†æ,ä¸åŒ…å«è§£å†³æ–¹æ¡ˆ
**ç›®æ ‡**: è¯†åˆ« CPG åœ¨æ”¯æŒ Java å¸¸é‡é©±åŠ¨å¯è¾¾æ€§åˆ†ææ—¶çš„æ‰€æœ‰å…³é”®ç¼ºé™·

---

## æ¦‚è¦

æœ¬æ–‡æ¡£å¯¹ CPG (Code Property Graph) æ¡†æ¶åœ¨ Java å¸¸é‡é©±åŠ¨å¯è¾¾æ€§åˆ†æåœºæ™¯ä¸­çš„èƒ½åŠ›ç¼ºé™·è¿›è¡Œå…¨é¢åˆ†æã€‚åŸºäº Task 3 æä¾›çš„ 4 ä¸ªçœŸå®ä»£ç åœºæ™¯,ä»¥åŠå¯¹ 100K+ LOC å¤§å‹ä»£ç åº“çš„ç”Ÿäº§çº§éœ€æ±‚,æœ¬åˆ†æè¯†åˆ«äº† **[TBD]** ä¸ªå…³é”®ç¼ºé™·ã€‚

### æ ¸å¿ƒå‘ç°

**é˜»å¡æ€§ç¼ºé™·**:
- **D1**: Static Final Field DFG ç¼ºå¤± - é˜»å¡ 100% åœºæ™¯
- **D2**: String.equals() æ±‚å€¼ä¸æ”¯æŒ - é˜»å¡ 75% åœºæ™¯
- **D3**: è¿‡ç¨‹é—´ DFG ç¼ºå¤± - é˜»å¡ 50% åœºæ™¯
- **D4**: Call Graph åŸºç¡€è®¾æ–½ç¼ºå¤± - é˜»å¡ 50% åœºæ™¯

**å½±å“é‡åŒ–**:
- **å¸¸é‡è¦†ç›–ç‡**: 70% çš„ Java å¸¸é‡ä½¿ç”¨ `static final` æ¨¡å¼,å½“å‰ CPG æ— æ³•æ±‚å€¼
- **åœºæ™¯æˆåŠŸç‡**: 0% (æ‰€æœ‰ 4 ä¸ª Task 3 åœºæ™¯å‡å¤±è´¥)
- **è¯¯æŠ¥ç‡**: é¢„è®¡ 80-90% (6 ä¸ªç±»æŠ¥å‘Šå¯è¾¾,å®é™…åªæœ‰ 1 ä¸ª)

### ç¼ºé™·åˆ†ç±»

æœ¬åˆ†æå°†ç¼ºé™·åˆ†ä¸º 4 ç±»:
- **Category A**: é˜»å¡ Task 3 åœºæ™¯ (P0 ä¼˜å…ˆçº§)
- **Category B**: çœŸå®å¤§å‹ä»£ç åº“å¿…éœ€ (P1-P2 ä¼˜å…ˆçº§)
- **Category C**: ç²¾åº¦å¢å¼º (P2-P3 ä¼˜å…ˆçº§)
- **Category D**: æ˜“ç”¨æ€§ä¸å·¥å…·é›†æˆ (P3-P4 ä¼˜å…ˆçº§)

[è¯¦ç»†åˆ†ç±»è§ Part 2]

---

## ç¬¬ä¸€éƒ¨åˆ†: åœºæ™¯é©±åŠ¨çš„ç¼ºé™·å‘ç°

æœ¬éƒ¨åˆ†ä»¥ Task 3 çš„ 4 ä¸ªåœºæ™¯ä¸ºé©±åŠ¨,é€ä¸ªåˆ†æå½“å‰ CPG çš„å¤±è´¥æ¨¡å¼,è¯†åˆ«é˜»å¡æ€§ç¼ºé™·ã€‚

---

### åœºæ™¯ 1: åŸºäºé™æ€å¸¸é‡çš„å·¥å‚æ¨¡å¼

#### 1.1 åœºæ™¯å›é¡¾

**ä»£ç æ¨¡å¼**: å·¥å‚æ–¹æ³•æ ¹æ®å¸¸é‡å‚æ•°é€‰æ‹©ä¸åŒçš„å®ç°ç±»

**å…³é”®ä»£ç ** (ç®€åŒ–):
```java
class KbGyomConst {
    public static final String TANPO_CAL_I_K_TOJITUYAK = "01";
    public static final String TANPO_CAL_I_K_2DDTEISEI = "02";
    // ... 4 more constants (total 6)
}

public TanpoCal generateTanpoCal(String sijiKbn, ...) {
    if (sijiKbn.equals(KbGyomConst.TANPO_CAL_I_K_TOJITUYAK)) {
        return new TanpoCalTodYak(...);  // Branch 1
    } else if (sijiKbn.equals(KbGyomConst.TANPO_CAL_I_K_2DDTEISEI)) {
        return new TanpoCal2ddTsei(...);  // Branch 2
    } else if (sijiKbn.equals(...)) {
        // ... 4 more branches (Branch 3-6)
    }
}
```

**å¯è¾¾æ€§éœ€æ±‚**:
- å‡è®¾è°ƒç”¨ç‚¹: `generateTanpoCal("01", ...)`
- **æœŸæœ›ç»“æœ**: åªæœ‰ `TanpoCalTodYak` å¯è¾¾,å…¶ä»– 5 ä¸ªç±»ä¸å¯è¾¾
- **ç²¾åº¦è¦æ±‚**: èƒ½å¤Ÿè¯†åˆ«å‚æ•° `"01"` å¯¹åº”å¸¸é‡ `KbGyomConst.TANPO_CAL_I_K_TOJITUYAK`,æ±‚å€¼ 6 ä¸ª `equals()` æ¡ä»¶,å‰ªæ 5 ä¸ªä¸å¯è¾¾åˆ†æ”¯

#### 1.2 å½“å‰ CPG è¡Œä¸ºè¯„ä¼°

åŸºäº Task 1 (Java Frontend) å’Œ Task 2 (CPG Core) çš„åˆ†æ,æ¨æ–­å½“å‰ CPG åœ¨æ­¤åœºæ™¯çš„è¡Œä¸º:

**Step 1: AST æ„å»º** (âœ… æˆåŠŸ)
- `JavaLanguageFrontend` æˆåŠŸè§£ææºç 
- `DeclarationHandler` åˆ›å»º `FieldDeclaration` èŠ‚ç‚¹ (å¯¹åº” `static final` å­—æ®µ)
- `StatementHandler` åˆ›å»º `IfStatement` èŠ‚ç‚¹ (å¯¹åº” 6 ä¸ªåˆ†æ”¯)
- `ExpressionHandler` åˆ›å»º `CallExpression` èŠ‚ç‚¹ (å¯¹åº” `equals()` è°ƒç”¨å’Œç±»å®ä¾‹åŒ–)

**è¯æ®**: Task 1 åˆ†ææ˜¾ç¤º Handler å¯ä»¥å¤„ç†æ‰€æœ‰æ ‡å‡† Java è¯­æ³•,æ­¤åœºæ™¯æ— ç‰¹æ®Šè¯­æ³•ã€‚

**Step 2: EOG æ„å»º** (âœ… æˆåŠŸ)
- `EvaluationOrderGraphPass` æ„å»ºæ§åˆ¶æµè¾¹
- æ¯ä¸ª `IfStatement` äº§ç”Ÿ 2 æ¡ EOG è¾¹: `branch=true` å’Œ `branch=false`
- 6 ä¸ªåˆ†æ”¯å¯¹åº” 6 æ¡ `branch=true` è·¯å¾„,æ¯æ¡è·¯å¾„åˆ°è¾¾ä¸€ä¸ªç±»å®ä¾‹åŒ–

**è¯æ®**: Task 2 åˆ†ææ˜¾ç¤º EOG æ„å»ºæ˜¯å®Œæ•´çš„,æ”¯æŒ if-else é“¾ã€‚

**Step 3: DFG æ„å»º** (âŒ **å¤±è´¥**)

**é¢„æœŸ**:
- `KbGyomConst.TANPO_CAL_I_K_TOJITUYAK` (FieldDeclaration) â†’ DFG â†’ `sijiKbn.equals(...)` (BinaryOperator)
- å³: å¸¸é‡å­—æ®µçš„ initializer ä¸ä½¿ç”¨ç‚¹ä¹‹é—´åº”è¯¥æœ‰ DFG è¾¹

**å®é™…è¡Œä¸º** (åŸºäº Task 1/2 åˆ†æ):
- âŒ `FieldDeclarationHandler` **ä¸åˆ›å»º** DFG è¾¹
  - **è¯æ®**: Task 1, `1.frontend-architecture.md`, Handler èŒè´£åˆ†ææŒ‡å‡º Handler ä¸»è¦åˆ›å»ºèŠ‚ç‚¹,ä¸è´Ÿè´£ DFG è¾¹
- âŒ `ControlFlowSensitiveDFGPass` **ä¸å¤„ç†** `static final` å­—æ®µ
  - **è¯æ®**: Task 2, `2.graph-and-query-analysis.md:450-480`, DFG Pass åªå¤„ç†å±€éƒ¨å˜é‡å’Œå‚æ•°
  - **åŸå› **: DFG Pass è®¾è®¡ä¸ºè¯­è¨€æ— å…³,ä¸åŒ…å« Java ç‰¹å®šçš„é™æ€å­—æ®µè¯­ä¹‰

**ç»“æœ**: `KbGyomConst.TANPO_CAL_I_K_TOJITUYAK` ä¸ `sijiKbn.equals(...)` ä¹‹é—´**æ—  DFG è¾¹**

**Step 4: å¸¸é‡æ±‚å€¼** (âŒ **å¤±è´¥**)

**é¢„æœŸ**:
- `ValueEvaluator.evaluate(KbGyomConst.TANPO_CAL_I_K_TOJITUYAK)` â†’ `"01"`
- `ValueEvaluator.evaluate(sijiKbn.equals("01"))` â†’ `true`

**å®é™…è¡Œä¸º** (åŸºäº Task 2 åˆ†æ):
1. **æ±‚å€¼ `KbGyomConst.TANPO_CAL_I_K_TOJITUYAK`**:
   - `ValueEvaluator` å°è¯•æ²¿ DFG å›æº¯åˆ°å¸¸é‡å®šä¹‰
   - âŒ **æ—  DFG è¾¹** (Step 3 å¤±è´¥) â†’ æ— æ³•å›æº¯
   - **ç»“æœ**: `cannotEvaluate(node, "No DFG edge to initializer")`

2. **æ±‚å€¼ `sijiKbn.equals(KbGyomConst.TANPO_CAL_I_K_TOJITUYAK)`**:
   - éœ€è¦æ±‚å€¼ä¸¤ä¸ªæ“ä½œæ•°: `sijiKbn` å’Œ `KbGyomConst.TANPO_CAL_I_K_TOJITUYAK`
   - âŒ `KbGyomConst.TANPO_CAL_I_K_TOJITUYAK` æ— æ³•æ±‚å€¼ (ä¸Šä¸€æ­¥å¤±è´¥)
   - âŒ `String.equals()` æ–¹æ³•è°ƒç”¨æ±‚å€¼ä¸æ”¯æŒ
   - **è¯æ®**: Task 2, `2.evaluation-infrastructure.md`, ValueEvaluator æ”¯æŒç®—æœ¯è¿ç®—ç¬¦,ä½†ä¸æ”¯æŒæ–¹æ³•è°ƒç”¨æ±‚å€¼
   - **ç»“æœ**: `cannotEvaluate(callExpr, "Method call evaluation not supported")`

**Step 5: åˆ†æ”¯å‰ªæ** (âŒ **å¤±è´¥**)

**é¢„æœŸ**:
- `UnreachableEOGPass` æ ¹æ®æ¡ä»¶æ±‚å€¼ç»“æœå‰ªæä¸å¯è¾¾åˆ†æ”¯
- 5 ä¸ª `branch=false` è¾¹æ ‡è®°ä¸º `unreachable=true`

**å®é™…è¡Œä¸º** (åŸºäº sem-003 åˆ†æ):
- `UnreachableEOGPass` è°ƒç”¨ `ValueEvaluator.evaluate(ifStmt.condition)`
- âŒ æ‰€æœ‰ 6 ä¸ªæ¡ä»¶éƒ½è¿”å› `cannotEvaluate` (Step 4 å¤±è´¥)
- **ç»“æœ**: æ‰€æœ‰ EOG è¾¹ä¿æŒ `unreachable=false` (é»˜è®¤å¯è¾¾)

**è¯æ®**: sem-003 (UnreachableEOGPass) è¡Œ 150-182 æ˜¾ç¤º,å¦‚æœ `evalResult` æ—¢ä¸æ˜¯ `true` ä¹Ÿä¸æ˜¯ `false`,åˆ™ `unreachableEdges = listOf()` (ä¸å‰ªæä»»ä½•è¾¹)ã€‚

**Step 6: å¯è¾¾æ€§æŸ¥è¯¢** (âŒ **è¯¯æŠ¥**)

**é¢„æœŸ**:
- Query: `executionPath(generateTanpoCal, { it is ConstructExpression })`
- **ç»“æœ**: åªæœ‰ `TanpoCalTodYak` æ„é€ å‡½æ•°å¯è¾¾

**å®é™…è¡Œä¸º**:
- Query éå†æ‰€æœ‰ `unreachable=false` çš„ EOG è¾¹
- âŒ æ‰€æœ‰ 6 æ¡åˆ†æ”¯è¾¹éƒ½æ˜¯ `unreachable=false` (Step 5 å¤±è´¥)
- **ç»“æœ**: æ‰€æœ‰ 6 ä¸ªç±»çš„æ„é€ å‡½æ•°éƒ½è¢«æŠ¥å‘Šä¸ºå¯è¾¾

**ç²¾åº¦æŸå¤±é‡åŒ–**:
- **è¯¯æŠ¥æ•°é‡**: 5 ä¸ªç±» (å®é™…ä¸å¯è¾¾ä½†æŠ¥å‘Šä¸ºå¯è¾¾)
- **è¯¯æŠ¥ç‡**: 5/6 = **83%**
- **ç²¾åº¦**: 1/6 = **17%** (åªæœ‰ 1 ä¸ªæ­£ç¡®è¯†åˆ«ä¸ºå¯è¾¾)

#### 1.3 æ ¹å› åˆ†æ - é˜»å¡æ€§ç¼ºé™·

åŸºäºä¸Šè¿°å¤±è´¥æ­¥éª¤,è¯†åˆ«é˜»å¡æ€§ç¼ºé™·:

---

##### ç¼ºé™· D1: Static Final Field DFG ç¼ºå¤±

**ç¼ºé™· ID**: D1
**åç§°**: Static Final Field DFG Missing
**ç±»åˆ«**: A (Blocking Task 3 Scenarios)
**ä¼˜å…ˆçº§**: P0

**é—®é¢˜æè¿°**:

Java çš„ `static final` å­—æ®µæ˜¯æœ€å¸¸è§çš„å¸¸é‡å®šä¹‰æ¨¡å¼ã€‚åœ¨çœŸå®é¡¹ç›®ä¸­,é…ç½®å¸¸é‡ã€æšä¸¾å€¼ã€ä¸šåŠ¡è§„åˆ™é€šå¸¸å®šä¹‰ä¸º `static final` å­—æ®µã€‚

å½“å‰ CPG å®ç°ä¸­,`static final` å­—æ®µçš„ **initializer (åˆå§‹åŒ–è¡¨è¾¾å¼)** ä¸ **field access (ä½¿ç”¨ç‚¹)** ä¹‹é—´**ç¼ºå°‘ DFG è¾¹**ã€‚è¿™å¯¼è‡´:
1. `ValueEvaluator` æ— æ³•æ²¿ DFG å›æº¯åˆ°å¸¸é‡å®šä¹‰
2. æ— æ³•æ±‚å€¼åŒ…å«é™æ€å­—æ®µå¼•ç”¨çš„è¡¨è¾¾å¼
3. æ— æ³•å‰ªæå¸¸é‡é©±åŠ¨çš„åˆ†æ”¯

**ä½ç½®**:


---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

æœ¬ Gap Analysis åˆ†ä¸º **6 ä¸ªç‹¬ç«‹æ–‡æ¡£**ï¼Œæ€»è®¡ ~6300 è¡Œï¼ŒæŒ‰é€»è¾‘æ¨¡å—æ‹†åˆ†ä¾¿äºé˜…è¯»ï¼š

### æ–‡æ¡£åˆ—è¡¨

| æ–‡ä»¶å | å†…å®¹ | è¡Œæ•° | é˜…è¯»ä¼˜å…ˆçº§ |
|--------|------|------|-----------|
| **[4.0-index.md](./4.0-index.md)** (æœ¬æ–‡æ¡£) | ğŸ“‹ ä¸»ç´¢å¼• + Executive Summary æ ¸å¿ƒå‘ç° | ~180 | â­â­â­â­â­ å¿…è¯» |
| **[4.1-scenarios.md](./4.1-scenarios.md)** | ğŸ¯ Part 1: åœºæ™¯é©±åŠ¨çš„ç¼ºé™·å‘ç° (4 ä¸ªåœºæ™¯è¯¦ç»†åˆ†æ) | ~1750 | â­â­â­â­ ç†è§£é—®é¢˜ |
| **[4.2-defects.md](./4.2-defects.md)** | ğŸ” Part 2: ç³»ç»ŸåŒ–ç¼ºé™·ç›®å½• (30 ç¼ºé™·ï¼Œ9 ä¸ªæ·±åº¦åˆ†æ) | ~1750 | â­â­â­â­â­ æ·±å…¥åˆ†æ |
| **[4.3-deployment.md](./4.3-deployment.md)** | ğŸ­ Part 3-4: æŠ½è±¡ç¨ + çœŸå®éƒ¨ç½²ç¼ºé™· | ~1000 | â­â­â­ æˆ˜ç•¥è§†è§’ |
| **[4.4-prioritization.md](./4.4-prioritization.md)** | ğŸ“Š Part 5: ä¼˜å…ˆçº§çŸ©é˜µ + è·¯çº¿å›¾ (5 Mermaid å›¾) | ~450 | â­â­â­â­â­ è¡ŒåŠ¨è®¡åˆ’ |
| **[4.5-reference.md](./4.5-reference.md)** | ğŸ“– Part 6 + é™„å½• (æ±‡æ€»ã€è¯æ®ã€æœ¯è¯­è¡¨ã€ç»“è®º) | ~1200 | â­â­ å‚è€ƒèµ„æ–™ |

### é˜…è¯»è·¯å¾„å»ºè®®

**ğŸš€ å¿«é€Ÿäº†è§£ï¼ˆ15 åˆ†é’Ÿï¼‰**:
1. é˜…è¯» **4.0-index.md** çš„ Executive Summary
2. æµè§ˆ **4.4-prioritization.md** çš„ Mermaid ä¾èµ–å›¾å’Œä¼˜å…ˆçº§çŸ©é˜µ

**ğŸ“– å…¨é¢ç†è§£ï¼ˆ1-2 å°æ—¶ï¼‰**:
1. **4.0-index.md** - äº†è§£æ ¸å¿ƒå‘ç°
2. **4.1-scenarios.md** - ç†è§£ 4 ä¸ªåœºæ™¯ä¸­çš„ç¼ºé™·è¡¨ç°
3. **4.2-defects.md** - æ·±å…¥ 9 ä¸ª P0-P1 ç¼ºé™·çš„æ ¹å› åˆ†æ
4. **4.4-prioritization.md** - æŒæ¡ä¿®å¤ä¼˜å…ˆçº§å’Œè·¯çº¿å›¾

**ğŸ”¬ æ·±åº¦ç ”ç©¶ï¼ˆ3-4 å°æ—¶ï¼‰**:
- æŒ‰é¡ºåºé˜…è¯»æ‰€æœ‰ 6 ä¸ªæ–‡æ¡£
- å‚è€ƒ **4.5-reference.md** çš„ä»£ç è¯æ®å’Œæœ¯è¯­è¡¨

---

## å¿«é€Ÿé“¾æ¥

### æ ¸å¿ƒå‘ç°
- [å½“å‰çŠ¶æ€è¯„ä¼°](#å½“å‰çŠ¶æ€è¯„ä¼°-current-state) (æœ¬æ–‡æ¡£)
- [30 ä¸ªç¼ºé™·æ¦‚è§ˆ](#ç¼ºé™·åˆ†ç±»-defect-categories) (æœ¬æ–‡æ¡£)
- [å…³é”®è·¯å¾„ D1â†’D2â†’D4â†’D3](./4.4-prioritization.md#å…³é”®è·¯å¾„åˆ†æ)
- [5 ä¸ª Mermaid å¯è§†åŒ–å›¾è¡¨](./4.4-prioritization.md#mermaid-diagrams)

### åœºæ™¯åˆ†æ
- [Scenario 1: Factory Pattern](./4.1-scenarios.md#scenario-1) - D1, D2 é˜»å¡
- [Scenario 2: Interprocedural](./4.1-scenarios.md#scenario-2) - D1-D4 é˜»å¡
- [Scenario 3: Nested Calls](./4.1-scenarios.md#scenario-3) - D1-D4 å‡çº§
- [Scenario 4: Enum Branching](./4.1-scenarios.md#scenario-4) - D1, D2, D6 é˜»å¡

### å…³é”®ç¼ºé™·æ·±åº¦åˆ†æ
- [D1: Static Final DFG Missing](./4.2-defects.md#d1-deep-dive) (P0, 100% åœºæ™¯é˜»å¡)
- [D2: String Operations Unsupported](./4.2-defects.md#d2-deep-dive) (P0, 75% åœºæ™¯é˜»å¡)
- [D3: Interprocedural DFG Missing](./4.2-defects.md#d3-deep-dive) (P0, 50% åœºæ™¯é˜»å¡)
- [D4: Call Graph Missing](./4.2-defects.md#d4-deep-dive) (P0, 50% åœºæ™¯é˜»å¡)
- [å®Œæ•´ 9 ä¸ª P0-P1 ç¼ºé™·åˆ—è¡¨](./4.2-defects.md#p0-p1-deep-dives)

### æˆ˜ç•¥åˆ†æ
- [å¤šè¯­è¨€æŠ½è±¡ç¨ (35-40%)](./4.3-deployment.md#part-3-abstraction-tax)
- [çœŸå®éƒ¨ç½²ç¼ºé™· (æ€§èƒ½/ç”Ÿæ€/é²æ£’æ€§)](./4.3-deployment.md#part-4-deployment-gaps)
- [ç«å“å¯¹æ¯” (Soot, WALA, SpotBugs)](./4.3-deployment.md#competitive-landscape)

### è¡ŒåŠ¨è®¡åˆ’
- [åœºæ™¯è¦†ç›–çŸ©é˜µ (30Ã—5)](./4.4-prioritization.md#scenario-coverage-matrix)
- [ç¼ºé™·ä¾èµ–å›¾ (Mermaid)](./4.4-prioritization.md#dependency-graph)
- [ä¼˜å…ˆçº§è·¯çº¿å›¾ (7 é˜¶æ®µ)](./4.4-prioritization.md#priority-roadmap)
- [é£é™©åˆ†æä¸ç¼“è§£](./4.4-prioritization.md#risk-analysis)

### å‚è€ƒèµ„æ–™
- [30 ç¼ºé™·å®Œæ•´ç›®å½•](./4.5-reference.md#part-6-master-catalog)
- [ä»£ç è¯æ®å¼•ç”¨ (460 è¡Œ)](./4.5-reference.md#appendix-a-evidence)
- [Task 3 åœºæ™¯ä»£ç  (210 è¡Œ)](./4.5-reference.md#appendix-b-scenarios)
- [æœ¯è¯­è¡¨ (60+ æœ¯è¯­)](./4.5-reference.md#appendix-c-glossary)
- [æœ€ç»ˆç»“è®º](./4.5-reference.md#conclusion)

---

